{% load i18n %}

<div class="modal fade" id="proxyModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
  <div class="proxy-dialog" role="document">
    <div class="modal-content">
      <div id="proxy-modal__header" class="modal-header proxy-modal__header">
        <div class="proxy-modal__title" id="myModalLabel">{% trans "Select Proxy User(s)" %}</div>
        <img src="/static/images/icon_cross.svg" alt="close" class="close login-modal__close" data-dismiss="modal" aria-label="Close">
      </div>
      <div class="modal-body">
        <div class="row">
          <select multiple size="10">
          {% for k,v in proxy_users.items %}
            <option value="{{k}}">[{{k}}]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{v}}</option>
          {% endfor %}
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{% trans "Cancel" %}</button>
        <button id="submit_close" type="button" class="btn btn-primary" name="submit_checks" value="Apply Changes">{% trans "Add user(s)" %}</button>
      </div>
    </div>
  </div>
</div>
<script type="text/javascript">
$("#submit_close").click(function(e){
  var assigned = $('#id_proxy_users_picked').val().split(', '),
      s = $('select option:selected'),
      re = /^\[(.*?)\]/;
  // Only add items not already found in list of already assigned proxy users
  s.each(function() {
      i = re.exec($( this ).text())[1];
      if ($.inArray( i, assigned ) == -1) {
          assigned.push(i);
      }
  });
  $('#id_proxy_users_picked').val(assigned.join(", "));
  $('#proxyModal').modal('hide');
});
</script>
