{% extends "layouts/base.html" %}
{% load layout_extras %}
{% load i18n %}

{% block title %}{%trans "Dashboard" %}{% endblock %}
{% block content %}
<div class="container vertical-buffer-xs">
{% if display_adminlink %}
  <form action="/admin" role="form">
    <button class="button__primary">{% trans "Administration" %}&nbsp;<span title="External Link" class="ext-icon"></span></button>
  </form>
  <hr/>
{% endif %}
  <div role="group" aria-labelledby="fieldset__owner-filter">
  <form id="usage_form" action="{% url "ui_admin.dashboard" %}" method="post">
    <div class="fieldset-stacked__inline-select dashboard__report-heading">
      <span id="fieldset__owner-filter" class="heading__icon-2">{% trans "View Report for" %}</span>
      <label for="owner_selected" class="fcontrol__text-label-hidden">{% trans "Specific User or Group" %}</label>

      {% include "includes/owner_select.html" %}

        <button class="dashboard__button-go" type="submit" value="submit">{% trans "Go" %}</button>
        <a href="" class="dashboard__csv-link">View CSV format of Identifier Creation</a>
    </div>
  </form>
  </div>
{% if report|length > 0 %}

{% include "dashboard/_totalIds.html" %}
{% include "dashboard/_totalIdsByMonth.html" %}
{% comment     include "dashboard/_totalIds.html" %}
{% endcomment %}

{% else %}
<p>There is no usage data for the selected group or user.</p>
{% endif %}
  <div class="col-md-12">
    <hr/>
    <h2 class="heading__icon-6">{% trans "Identifier Issues" %}</h2>
      <div id="error_issues"></div>
      <div id="loading_issues" class="loading"></div>
      <div id="ajax_issues">
        {% include "dashboard/_issues.html" %}
      </div>
    <h2 class="heading__icon-10">{% trans "Crossref&reg; Submission Status" %}</h2>
      <div id="error_crossref"></div>
      <div id="loading_crossref" class="loading"></div>
      <div id="ajax_crossref">
        {% include "dashboard/_crossref.html" %}
      </div>
  </div>
</div>

<script type="text/javascript">
var li = $('#loading_issues').hide(),
    lc = $('#loading_crossref').hide();
$('#page-directselect-issues').change(function() {
    //Make a namespace for distinguishing ajax calls from issues table vs crossref table
    $(document).off(".crossRefCall");
    $(document).on("ajaxStart.issuesCall", function () {
        li.show();
    }).on("ajaxStop.issuesCall", function () {
        li.hide();
    });
});
$('#page-directselect-crossref').change(function() {
    $(document).off(".issuesCall");
    $(document).on("ajaxStart.crossRefCall", function () {
        lc.show();
    }).on("ajaxStop.crossRefCall", function () {
        lc.hide();
    });
});
</script>
{% endblock %}
