{% extends "layouts/base.html" %}
{% load metadata_tags %}
{% load layout_extras %}

{% block title %}Edit Identifier Details{% endblock %}

{% block header %}
{% endblock %}

{% block javascript %}

{% endblock %}

{% block content %}
  <form id="edit_form" action="{% url "ui_manage.edit" id_text %}" method="post">
    <!-- original profile is the profile that was loaded before possibly being changed from drop-down list -->
    <input name="action" id="action"  type="hidden" value="edit"/>
    <input name="identifier" id="identifier"  type="hidden" value="{{ id_text }}"/>
    <input name="original_profile" id="original_profile"  type="hidden" value="{{current_profile.name}}"/>
    <input name="simpleToAdvanced" id="simpleToAdvanced"  type="hidden" value="False"/>
    <!-- current profile updated via JavaScript when converting from simple to advanced ID -->
  <div class="grid_9">
  	<div style="float:right">
  	</div>
    <h1>Identifier Details</h1>
    <div class="left_desc">Identifier:</div>
    <div class="right_val">
      <div style="float:left;padding-right:20px;">
        {{ id_text }}
      </div>
       {% include "includes/get_link.html" %}
    </div>
    
    <div style="clear:left;"></div>
    
    <h2>About the identified object</h2>
      <p>This identified object uses the <strong>{{ current_profile.displayName }}</strong> citation profile.</p>
      <label for="_target" class="left {% tooltip_class "_target" %}">
        {{internal_profile.target.displayName}}:
      </label>
      <div class="field_right {% tooltip_class "_target" %}">
        <input type="text" name="_target" id="_target" size="35" value="{% form_or_dict_value identifier "_target" %}" class="std_form_width" />
      </div>

      {% if manual_profile %}
        <div style="clear:both;">
        {% include manual_template %}
        </div>
      {% else %}
        {% for e in current_profile.elements %}
        <label for="{{e.name}}" class="left {% tooltip_class e.name %}">
          {{e.displayName}}:
        </label>
        <div class="field_right">
          {% display_form_element e identifier %}
          {% if current_profile.name == 'datacite' and e.name != 'datacite.resourcetype' %}
		{% datacite_field_help_icon e.name %}
  	  {% endif %}
        </div>        
        {% endfor %}
      {% endif %}

    	<label class="left">&nbsp;</label>
    	<div class="field_right">
          <input type="submit" value="Save changes"/>
    	</div>
      <div style="clear:both;"></div>

      <h2>About the identifier</h2>
      <table>
      	<tr>
	      	<td class='{% tooltip_class "_owner label_col" %}'>{{internal_profile.owner.displayName}}:</td>
	      	<td>{% display_value identifier internal_profile.owner %}</td>
	    	</tr>
	    	
	    	<tr>
		      <td class='{% tooltip_class "_ownergroup" %}'>{{internal_profile.ownergroup.displayName}}:</td>
		      <td>{% display_value identifier internal_profile.ownergroup %}</td>
		    </tr>
		    
		    <tr>
		      <td class='{% tooltip_class "_coowners" %}'>{{internal_profile.coowners.displayName}}:</td>
		      <td>{% display_value identifier internal_profile.coowners %}</td>
		    </tr>
		    
		    <tr>
		      <td class='{% tooltip_class "_created" %}'>{{internal_profile.created.displayName}}:</td>
		      <td>{% display_value identifier internal_profile.created %}</td>
		    </tr>
		    
		    <tr>
		      <td class='{% tooltip_class "_updated" %}'>{{internal_profile.updated.displayName}}:</td>
		      <td>{% display_value identifier internal_profile.updated %}</td>
		    </tr>
		    
		   	<tr>
		    	<td class='{% tooltip_class "_status" %}'>{{internal_profile.status.displayName}}:</td>
		      <td>
		     		{% if orig_status == 'reserved' %}
			      	<input type="radio" name="_status" id="_status_reserved"
			      		value="reserved"
			      		{% if pub_status == 'reserved' %}
			      			checked="checked"
			      		{% endif %}
			      		 /><label for="_status_reserved">reserved</label>&nbsp;&nbsp;
						{% endif %}		            
		        <input type="radio" name="_status" id="_status_public" value="public"
		            {% if pub_status == 'public' %}
		              checked="checked"
		            {% endif %}/><label for="_status_public">public</label>&nbsp;&nbsp;
		        
		        {% if orig_status != 'reserved' %}    
			        <input type="radio" name="_status" id="_status_unavailable" value="unavailable"
			            {% if pub_status == 'unavailable' %}
			              checked="checked"
			            {% endif %}/><label for="_status_unavailable">unavailable</label>&nbsp;&nbsp;
		        {% endif %}
		        {% help_icon "public_id_help" %}
		      </td>
		    </tr>
		    
		    <tr id="unavailable_reason_row"
		    	{% if pub_status == 'unavailable' %}
		    		style="display: visible;"
		    	{% else %}
		    		style="display: none;"
		    	{% endif %}
		    		>
		    	<td>Unavailable reason:</td>
		      <td>
						<input type="text" name="stat_reason" id="stat_reason" size="35"
						{% if stat_reason %}
							value="{{stat_reason}}"
						{% else %}
							value=""
						{% endif %}
						
						class="std_form_width" />
						
						{% help_icon "unavail_reason_help" %}
		      </td>
		    </tr>
		    
	      <tr id="indexing_row">
	      	<td colspan="2">
		        <p>
		          Allow harvesting/indexing?&nbsp;&nbsp;
		          <input type="radio" name="_export" id="export_yes" value="yes"
		            {% if export == 'yes' %}
		              checked="checked"
		            {% endif %}/><label for="export_yes">Yes</label>&nbsp;&nbsp;
		          <input type="radio" name="_export" id="export_no" value="no"
		          {% if export != 'yes' %}
		            checked="checked"
		          {% endif %}
		          /><label for="export_no">No</label>
		          {% help_icon "export_help" %}
		        </p>
	       	</td>
	      </tr>
      </table>
  </div>
  <div class="grid_3">
    <br/><br/><br/><br/><br/><br/>
    {% if not manual_profile %}
      <div class="squarebox">
        <div class="squareboxpad">
          {% if not manual_profile and current_profile.name == "datacite" %}
            <input id="profile_simpleToAdvanced" type="button" name="simpleToAdvanced" value="&gt;&gt;&nbsp; Add more information to the record" onclick="profileSimpleToAdvanced(event);" class="link-lookalike"/>
          {% elif not manual_profile and current_profile.name != "datacite" %}
            <!-- span style="float:left;margin-left:8px">Would you like to add more information to the record?</span --> 
            Would you like to add more information to the record?
            <input id="profile_simpleToAdvanced" type="button" name="simpleToAdvanced" value="&gt;&gt;&nbsp; Convert to the DataCite citation profile" onclick="profileSimpleToAdvanced(event);" class="link-lookalike"/> <span style="position:relative;top:-50px;left:83%"> {% help_icon "which_profile" %} </span> 
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
  </form>
  
  <script type="text/javascript">
        // submit form when profile changed
          $("#current_profile").bind("change", function(event){
            $("#edit_form").submit();
          });
    function profileSimpleToAdvanced(e){
        e.preventDefault();
        $("input[type=hidden][name=simpleToAdvanced]").val('True');
        $('#edit_form').submit();
    }
    function setHidden(){
    	if ($('#_status_unavailable').is(':checked')) {
   			// unavailable
    		$("#unavailable_reason_row").show();
    		$("#indexing_row").hide();
			} else if ($('#_status_reserved').is(':checked')) {
				// reserved
    		$("#unavailable_reason_row").hide();
    		$("#indexing_row").hide();
			}else{
				// public
				$("#unavailable_reason_row").hide();
				$("#indexing_row").show();
			}
    }
		$("[name='_status']").bind("change", function(){
			setHidden();
    });
    setHidden();
  </script>
  
  {% include "info/popup_help.html" %}
  <script type="text/javascript" src="/static/javascripts/help_box.js"></script>

{% endblock %}
