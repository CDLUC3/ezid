{% extends "layouts/base.html" %}
{% load metadata_tags %}
{% load layout_extras %}
{% load i18n %}

{% block title %}{% trans "Edit Identifier Details" %}{% endblock %}

{% block heading %}{% content_heading _("Identifier Details") %}{% endblock %}
{% block content %}
<div class="container vertical-buffer-20">
  <form id="edit_form" action="{% url "ui_manage.edit" id_text %}" method="post" class="form-horizontal" role="form">
    <!-- original profile is the profile that was loaded before possibly being changed from drop-down list -->
    <input name="action" id="action"  type="hidden" value="edit"/>
    <input name="identifier" id="identifier"  type="hidden" value="{{ id_text }}"/>
    <input name="original_profile" id="original_profile"  type="hidden" value="{{current_profile.name}}"/>
    <input name="simpleToAdvanced" id="simpleToAdvanced"  type="hidden" value="False"/>
  <div class="row vertical-buffer-bot">
    <label class="col-xs-2">{% trans "Identifier" %}:</label>
    <div class="col-sm-7 col-xs-10"><strong>{% identifier_display id_text testPrefixes %}</strong></div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2 col-xs-2">{% trans "Identifier as URL" %}:</label>
    <div class="col-sm-5 col-xs-8">
      {% full_url_to_id_details id_text %}
    </div>
  </div>
  <div class="row">
    <div class="col-xs-2 col-xs-offset-2">
      {% include "includes/get_link.html" %}
    </div>
  </div>
  <div class="row vertical-buffer-20 vertical-buffer-bot">
    <div class="inline-header">
      <img id="id__icon--aboutobject" src="/static/images/idAboutObject.svg" ALT="">
        <h3>{% trans "ABOUT THE IDENTIFIED OBJECT" %}</h3>
    </div>
    <div class="row vertical-buffer-xs">
      <label class="col-sm-7"><small>{% trans "This identified object uses the" %} <strong>{{ current_profile.displayName }}</strong> {% trans "profile" %}.</small></label>
    </div>
  </div>
  <div class="row vertical-buffer-20">
    <div class="form-group form-group-sm">
      <label for="_target" class="col-sm-2">{{internal_profile.target.displayName}}: </label>
      <div class="col-sm-7">
        <input type="text" class="form-control" name="_target" id="_target" value="{% form_or_dict_value identifier "_target" %}" />
      </div>
    </div>
  </div>

  {% if manual_profile %}
    {% include manual_template %}
  {% else %}
    {% for e in current_profile.elements %}
  <div class="row">
    <div class="form-group form-group-sm">
      <label for="{{e.name}}" class="col-sm-2">
        {{e.displayName}}:
      </label>
      <div class="col-sm-7">
        {% display_form_element e identifier %}
        {% if current_profile.name == 'datacite' and e.name != 'datacite.resourcetype' %}
        {% endif %}
      </div>        
    </div>
  </div>
    {% endfor %}
  {% endif %}

  <div class="vertical-buffer-20"> </div>
  <div class="row vertical-buffer-bot">
    <div class="inline-header">
      <img id="id__icon--aboutid" src="/static/images/idAboutID.svg" ALT="">
        <h3>{% trans "ABOUT THE IDENTIFIER" %}</h3>
    </div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2 col-xs-3">{{internal_profile.owner.displayName}}:</label>
    <div class="col-sm-7 col-xs-9">{% display_value identifier internal_profile.owner %}</div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2 col-xs-3">{{internal_profile.ownergroup.displayName}}:</label>
    <div class="col-sm-7 col-xs-9">{% display_value identifier internal_profile.ownergroup %}</div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2 col-xs-3">{{internal_profile.coowners.displayName}}:</label>
    <div class="col-sm-7 col-xs-9">{% display_value identifier internal_profile.coowners %}</div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2">{{internal_profile.created.displayName}}:</label>
    <div class="col-sm-7">{% display_value identifier internal_profile.created %}</div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-sm-2">{{internal_profile.updated.displayName}}:</label>
    <div class="col-sm-7">{% display_value identifier internal_profile.updated %}</div>
  </div>
  <div class="row vertical-buffer-bot">
    <label class="col-xs-2">{{internal_profile.status.displayName}}:</label>
    <div class="col-xs-7">
      <div class="form-group form-group-sm">
		     		{% if orig_status == 'reserved' %}
			      	<input type="radio" name="_status" id="_status_reserved"
			      		value="reserved"
			      		{% if pub_status == 'reserved' %}
			      			checked="checked"
			      		{% endif %}
			      		 /><label for="_status_reserved">{% trans "reserved" %}</label>&nbsp;&nbsp;
						{% endif %}		            
		        <input type="radio" name="_status" id="_status_public" value="public"
		            {% if pub_status == 'public' %}
		              checked="checked"
		            {% endif %}/><label for="_status_public">{% trans "public" %}</label>&nbsp;&nbsp;
		        
		        {% if orig_status != 'reserved' %}    
			        <input type="radio" name="_status" id="_status_unavailable" value="unavailable"
			            {% if pub_status == 'unavailable' %}
			              checked="checked"
			            {% endif %}/><label for="_status_unavailable">{% trans "unavailable" %}</label>&nbsp;&nbsp;
		        {% endif %}
		        {% help_icon "decide_public" %}
      </div>
    </div>
  </div>
  <div id="unavailable_reason_row" 
    {% if pub_status == 'unavailable' %}
      style="display: visible;"
    {% else %}
      style="display: none;"
    {% endif %}
    class="row vertical-buffer-bot">
    <label class="col-sm-2">{% trans "Unavailable reason" %}:</label>
    <div class="col-sm-7">
      <div class="form-group form-group-sm">
        <input type="text" name="stat_reason" id="stat_reason" 
          {% if stat_reason %}
            value="{{stat_reason}}"
          {% else %}
            value=""
          {% endif %}
          class="form-control" />
      </div>
    </div>
  </div>
  <div id="indexing_row" class="row vertical-buffer-bot">
    <label class="col-sm-2 col-xs-3">{% trans "Allow harvesting/indexing?" %}</label>
    <div class="col-sm-7 col-xs-9">
      <div class="form-group form-group-sm">
        <input type="radio" name="_export" id="export_yes" value="yes"
          {% if export == 'yes' %}
            checked="checked"
          {% endif %}/><label for="export_yes">{% trans "Yes" %}</label>&nbsp;&nbsp;
        <input type="radio" name="_export" id="export_no" value="no"
        {% if export != 'yes' %}
          checked="checked"
        {% endif %}
        /><label for="export_no">{% trans "No" %}</label>
        {% help_icon "decide_export" %}
      </div>
    </div>
  </div>
  <div class="row vertical-buffer-sm">
    <div class="form-group form-group-sm">
      <div class="col-sm-12">
        <button type="submit" class="btn btn-primary padding-side-med">
          {% trans "SAVE CHANGES" %}</button>
      </div>
    </div>
  </div>

  <div class="grid_3">
    <br/><br/><br/><br/><br/><br/>
    {% if not manual_profile %}
      <div class="squarebox">
        <div class="squareboxpad">
          {% if not manual_profile and current_profile.name == "datacite" %}
            <input id="profile_simpleToAdvanced" type="button" name="simpleToAdvanced" value="&gt;&gt;&nbsp; Add more information to the record" onclick="profileSimpleToAdvanced(event);" class="link-lookalike"/>
          {% elif not manual_profile and current_profile.name != "datacite" %}
            Would you like to add more information to the record?
            <input id="profile_simpleToAdvanced" type="button" name="simpleToAdvanced" value="&gt;&gt;&nbsp; Convert to the DataCite citation profile" onclick="profileSimpleToAdvanced(event);" class="link-lookalike"/> <span style="position:relative;top:-50px;left:83%"></span> 
          {% endif %}
        </div>
      </div>
    {% endif %}
  </div>
  </form>
  
  <script type="text/javascript">
        // submit form when profile changed
          $("#current_profile").bind("change", function(event){
            $("#edit_form").submit();
          });
    function profileSimpleToAdvanced(e){
        e.preventDefault();
        $("input[type=hidden][name=simpleToAdvanced]").val('True');
        $('#edit_form').submit();
    }
    function setHidden(){
    	if ($('#_status_unavailable').is(':checked')) {
   			// unavailable
    		$("#unavailable_reason_row").show();
    		$("#indexing_row").hide();
			} else if ($('#_status_reserved').is(':checked')) {
				// reserved
    		$("#unavailable_reason_row").hide();
    		$("#indexing_row").hide();
			}else{
				// public
				$("#unavailable_reason_row").hide();
				$("#indexing_row").show();
			}
    }
		$("[name='_status']").bind("change", function(){
			setHidden();
    });
    setHidden();
  </script>
  
  {% include "info/popup_help.html" %}
  <script type="text/javascript" src="/static/javascripts/help_box.js"></script>
</div>
{% endblock %}
