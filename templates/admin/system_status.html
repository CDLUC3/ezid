{% extends "layouts/base.html" %}

{% block title %}System Status{% endblock %}

{% block content %}
  <div class="grid_9">
    <h1>System Status</h1>
    <table class="status">
    	<tr>
    		<th>Status</th>
    		<th>Resource</th>
    	</tr>
    	{% for ss in status_list %}
		  	<tr>
		  		<td id='{{ss.id}}' class="update_status"><img src='/ezid/static/images/ajax-loader_gray.gif' alt='Progress indicator' /></td>
		  		<td>{{ss.name}}</td>
		  	</tr>
    	{% endfor %}
    </table>
  </div>
  
  <div class="grid_3">
  	<br/>
  	<div class="status_sidebox">
  		<h2>Legend</h2>
  		<p><img src="/ezid/static/images/good_flag.png" alt="service up">&nbsp;&nbsp;Service up</p>
  		<p><img src="/ezid/static/images/maybe_flag.png" alt="service state unknown">&nbsp;&nbsp;Service state unknown</p>
  		<p><img src="/ezid/static/images/fail_flag.png" alt="service down">&nbsp;&nbsp;Service down</p>
  	</div>
  	<br/><br/>
  	<div class="status_sidebox" style="text-align:center">
  		<h2>For Developer Use Only</h2>
  		<form id="reloadit" action="{% url ui_admin.system_status %}" method="post" >
  			<input type="submit" value="Reload EZID"/>
  		</form>
  		<br/>
  	</div>
  </div>
  <script type="text/javascript">
    $('.update_status').each(function() {
    	$('#' + this.id).load('{% url ui_admin.ajax_system_status %}' + "?id=" + this.id)
    	$('#' + this.id).show(); // this is to keep Safari repainting and not freezing while ajax is continuously loading
    });
    
    function updateUI () {
   		// change ui state
   		document.setTimeout( updateUI, 1 );
		}
  	
  </script>
{% endblock %}