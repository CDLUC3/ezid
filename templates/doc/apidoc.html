{% extends "layouts/apidoc.html" %}
{% load layout_extras %}
{% load i18n %}
{% load menus %}
{% block title %}{% block title-twitter %}
{% trans "The EZID API, Version 2" %}
{% endblock %}{% endblock %}
{% block heading %}
{% content_heading _("The EZID API, Version 2") %}
{% endblock %}
{% block content %}
{% learn_breadcrumb _("API Guide") %}
<div class="container api vertical-buffer-20"><div class="smallfont line-block">
<div class="line"><strong>This version:</strong> <a class="reference external" href="{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.2.html">{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.2.html</a></div>
<div class="line"><strong>Latest version:</strong> <a class="reference external" href="{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.html">{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.html</a></div>
<div class="line"><strong>Previous version:</strong> <a class="reference external" href="{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.1.html">{{ request.scheme }}://{{ request.META.HTTP_HOST }}/doc/apidoc.1.html</a></div>
</div>
<p>EZID (easy-eye-dee) provides an easy way to obtain, describe, and
manage long-term identifiers for digital objects.  It can be accessed
via a web User Interface (UI) and a web Application Programming
Interface (API).  A few account management functions can be accessed
from the UI only, but otherwise all of EZID's functionality is
available through the API.  This document describes Version 2 of the
EZID API.</p>
<p>Please send mail to the EZID discussion list (open to EZID customers
only) to ask questions or report problems:</p>
<blockquote>
<a class="reference external" href="mailto:ezid-l&#64;listserv.ucop.edu">ezid-l&#64;listserv.ucop.edu</a></blockquote>
<div class="section" id="contents">
<h1>Contents</h1>
<ul class="simple">
<li><a class="reference internal" href="#framework">Framework</a></li>
<li><a class="reference internal" href="#api-vs-ui">API vs. UI</a></li>
<li><a class="reference internal" href="#authentication">Authentication</a></li>
<li><a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a></li>
<li><a class="reference internal" href="#error-reporting">Error reporting</a></li>
<li><a class="reference internal" href="#operation-get-identifier-metadata">Operation: get identifier metadata</a></li>
<li><a class="reference internal" href="#operation-create-identifier">Operation: create identifier</a></li>
<li><a class="reference internal" href="#operation-mint-identifier">Operation: mint identifier</a></li>
<li><a class="reference internal" href="#operation-update-identifier">Operation: update identifier</a></li>
<li><a class="reference internal" href="#operation-create-or-update-identifier">Operation: create or update identifier</a></li>
<li><a class="reference internal" href="#operation-delete-identifier">Operation: delete identifier</a></li>
<li><a class="reference internal" href="#suffix-passthrough-prefix-matching">Suffix passthrough / prefix matching</a></li>
<li><a class="reference internal" href="#ownership-model">Ownership model</a></li>
<li><a class="reference internal" href="#identifier-status">Identifier status</a></li>
<li><a class="reference internal" href="#internal-metadata">Internal metadata</a></li>
<li><a class="reference internal" href="#metadata-profiles">Metadata profiles</a><ul>
<li><a class="reference internal" href="#profile-erc">Profile &quot;erc&quot;</a></li>
<li><a class="reference internal" href="#profile-datacite">Profile &quot;datacite&quot;</a></li>
<li><a class="reference internal" href="#profile-dc">Profile &quot;dc&quot;</a></li>
<li><a class="reference internal" href="#profile-crossref">Profile &quot;crossref&quot;</a></li>
</ul>
</li>
<li><a class="reference internal" href="#metadata-requirements-mapping">Metadata requirements &amp; mapping</a></li>
<li><a class="reference internal" href="#crossref-registration">Crossref registration</a></li>
<li><a class="reference internal" href="#testing-the-api">Testing the API</a></li>
<li><a class="reference internal" href="#server-status">Server status</a></li>
<li><a class="reference internal" href="#python-command-line-tool">Python command line tool</a></li>
<li><a class="reference internal" href="#php-examples">PHP examples</a></li>
<li><a class="reference internal" href="#perl-examples">Perl examples</a></li>
<li><a class="reference internal" href="#java-example">Java example</a></li>
<li><a class="reference internal" href="#curl-examples">curl examples</a></li>
<li><a class="reference internal" href="#batch-processing">Batch processing</a></li>
<li><a class="reference internal" href="#batch-download">Batch download</a><ul>
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#download-formats">Download formats</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#using-curl-to-request-a-download">Using curl to request a download</a></li>
</ul>
</li>
<li><a class="reference internal" href="#oai-pmh-harvesting">OAI-PMH harvesting</a></li>
</ul>
</div>
<div class="section" id="framework">
<h1>Framework</h1>
<p>The EZID API is available from the base URL</p>
<blockquote>
<a class="reference external" href="https://ezid.cdlib.org">https://ezid.cdlib.org</a></blockquote>
<p>Interaction is via <a class="reference external" href="http://oreilly.com/catalog/9780596529260">REST-style</a> <span class="ext-icon"></span> HTTP web services.  The
API's central design principle is to treat an identifier as a kind of
web resource.  Specifically, identifier <span class="hl1">foo</span> is represented as a
resource at URL https://ezid.cdlib.org/id/<span class="hl1">foo</span>.  In this
document we will refer to this URL as the identifier's &quot;EZID URL.&quot;  A
client manipulates an identifier by performing HTTP operations on its
EZID URL: PUT to create the identifier, GET to view it, and POST to
update it.</p>
<p>An identifier's EZID URL should not be confused with the identifier's
&quot;URL form.&quot;  The former is used to manipulate the identifier, whereas
the latter is used to express the identifier as an embeddable
hyperlink that redirects to the identifier's target URL.  For DOI
identifiers:</p>
<table border="1" class="leftheaders docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr><td>Identifier</td>
<td><span class="hl1">doi:10.nnnn/suffix</span></td>
</tr>
<tr><td>URL form</td>
<td>https://doi.org/<span class="hl1">10.nnnn/suffix</span></td>
</tr>
<tr><td>EZID URL</td>
<td>https://ezid.cdlib.org/id/<span class="hl1">doi:10.nnnn/suffix</span></td>
</tr>
</tbody>
</table>
<p>For ARK identifiers:</p>
<table border="1" class="leftheaders docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr><td>Identifier</td>
<td><span class="hl1">ark:/nnnnn/suffix</span></td>
</tr>
<tr><td>URL form</td>
<td>http://n2t.net/<span class="hl1">ark:/nnnnn/suffix</span></td>
</tr>
<tr><td>EZID URL</td>
<td>https://ezid.cdlib.org/id/<span class="hl1">ark:/nnnnn/suffix</span></td>
</tr>
</tbody>
</table>
<p>For UUID identifiers:</p>
<table border="1" class="leftheaders docutils">
<colgroup>
<col width="16%" />
<col width="84%" />
</colgroup>
<tbody valign="top">
<tr><td>Identifier</td>
<td><span class="hl1">uuid:suffix</span></td>
</tr>
<tr><td>URL form</td>
<td>http://n2t.net/<span class="hl1">uuid:suffix</span></td>
</tr>
<tr><td>EZID URL</td>
<td>https://ezid.cdlib.org/id/<span class="hl1">uuid:suffix</span></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="api-vs-ui">
<h1>API vs. UI</h1>
<p>The EZID UI and API share some URLs (the base URL is the same for
both) but their behavior is different.  For example, in the API a GET
operation on an EZID URL returns client-parseable metadata (see
<a class="reference internal" href="#operation-get-identifier-metadata">Operation: get identifier metadata</a> below), but in the UI it returns
an HTML page.</p>
<p>To distinguish between the two interfaces EZID employs HTTP <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc9110.html#name-content-negotiation">content
negotiation</a> <span class="ext-icon"></span>.  If a request comes in with an HTTP
Accept header that expresses a preference for any form of HTML or XML,
the UI is invoked; otherwise, the API is invoked.  A preference for
the API can be made explicit by omitting any Accept header, or setting
the Accept header to something like &quot;text/plain&quot;.  If using Java, it
will probably be necessary to override the default Accept header Java
sends as follows:</p>
<pre class="literal-block">
import java.net.*;

URL u = new URL(&quot;https://ezid.cdlib.org/...&quot;);
URLConnection c = u.openConnection();
c.setRequestProperty(&quot;Accept&quot;, &quot;text/plain&quot;);
c.connect();
</pre>
</div>
<div class="section" id="authentication">
<h1>Authentication</h1>
<p>Most requests require authentication.  The EZID API supports two
methods of authentication:</p>
<ol class="arabic">
<li><p class="first"><strong>HTTP Basic authentication</strong>.  With this method, the client
supplies HTTP Basic authentication credentials on every request.
The authentication realm is &quot;EZID&quot;.  For example, credentials can
be added manually in Python as follows:</p>
<pre class="literal-block">
import base64, urllib2
r = urllib.request.Request(&quot;https://ezid.cdlib.org/...&quot;)
r.add_header(&quot;Authorization&quot;, &quot;Basic &quot; + base64.b64encode(&quot;<span class="hl2">username</span>:<span class="hl2">password</span>&quot;))
</pre>
<p>But most programming libraries provide higher-level support for
authentication.  For example, Python provides HTTPBasicAuthHandler:</p>
<pre class="literal-block">
import urllib2
h = urllib.request.HTTPBasicAuthHandler()
h.add_password(&quot;EZID&quot;, &quot;https://ezid.cdlib.org/&quot;, &quot;<span class="hl2">username</span>&quot;, &quot;<span class="hl2">password</span>&quot;)
o = urllib.request.build_opener(h)
o.open(&quot;https://ezid.cdlib.org/...&quot;)
</pre>
<p>The downside of using higher-level authentication mechanisms is
that they often do not supply credentials initially, but only in
response to a challenge from EZID, thus doubling the number of HTTP
transactions.</p>
<p>To manually provide credentials in Java, using <a class="reference external" href="http://commons.apache.org/codec/">Apache Commons
Codec</a> <span class="ext-icon"></span> to do the Base64 encoding:</p>
<pre class="literal-block">
import java.net.*;
import org.apache.commons.codec.binary.*;

URL u = new URL(&quot;https://ezid.cdlib.org/...);
URLConnection c = u.openConnection();
c.setRequestProperty(&quot;Accept&quot;, &quot;text/plain&quot;);
c.setRequestProperty(&quot;Authorization&quot;, &quot;Basic &quot; +
  new String(Base64.encodeBase64(&quot;<span class="hl2">username</span>:<span class="hl2">password</span>&quot;.getBytes())));
c.connect();
</pre>
<p>Java also provides an Authenticator class:</p>
<pre class="literal-block">
import java.net.*;

class MyAuthenticator extends Authenticator {
  protected PasswordAuthentication getPasswordAuthentication () {
    return new PasswordAuthentication(&quot;<span class="hl2">username</span>&quot;, &quot;<span class="hl2">password</span>&quot;.toCharArray());
  }
}

Authenticator.setDefault(new MyAuthenticator());
</pre>
</li>
<li><p class="first"><strong>One-time login</strong>.  Perform a GET operation on
https://ezid.cdlib.org/login and supply HTTP Basic credentials as
above.  In response, EZID returns a session cookie.  Subsequent
requests can be made without authentication by supplying the
session cookie in HTTP Cookie headers.  Here's an example
interaction:</p>
<pre class="literal-block">
⇒ GET /login HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Authorization: Basic dXNlcm5hbWU6cGFzc3dvcmQ=

⇐ HTTP/1.1 200 OK
⇐ Set-Cookie: sessionid=403a1ea3b03b74f663c1cd7fc877f495; expires...
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 32
⇐
⇐ success: session cookie returned
</pre>
<p>In Python, cookies can be managed using <a class="reference external" href="http://docs.python.org/library/cookielib.html">cookielib</a> <span class="ext-icon"></span>,
or manually captured and set using code similar to the following:</p>
<pre class="literal-block">
import urllib2
c = urllib.request.urlopen(&quot;https://ezid.cdlib.org/login&quot;)
<span class="hl2">cookie</span> = c.headers[&quot;Set-Cookie&quot;].split(&quot;;&quot;)[0]
...
r = urllib.request.Request(&quot;https://ezid.cdlib.org/...&quot;)
r.add_header(&quot;Cookie&quot;, <span class="hl2">cookie</span>)
</pre>
<p>In Java, cookies can be manually captured and set using code
analogous to the Python code above or, in Java 1.6 and newer,
<a class="reference external" href="http://download.oracle.com/javase/6/docs/api/java/net/CookieManager.html">CookieManager</a> <span class="ext-icon"></span> can be used to manage cookies.</p>
<p>Perform a GET operation on https://ezid.cdlib.org/logout to
invalidate a session.</p>
</li>
</ol>
<p>If authentication is required and credentials are either missing or
invalid, EZID returns a 401 HTTP status code and the status line
&quot;error: unauthorized&quot; (see <a class="reference internal" href="#error-reporting">Error reporting</a> below).  If
authentication is successful but the request is still not authorized,
EZID returns a 403 HTTP status code and the status line &quot;error:
forbidden&quot;.</p>
</div>
<div class="section" id="request-response-bodies">
<h1>Request &amp; response bodies</h1>
<p>Request and response bodies are used to transmit identifier metadata.
The HTTP content type for all bodies is &quot;text/plain&quot; using UTF-8
charset encoding.  In request bodies, if no charset encoding is
declared in the HTTP Content-Type header, it is assumed to be UTF-8.</p>
<p>EZID's data model for metadata is a dictionary of element name/value
pairs.  The dictionary is single-valued: an element name may not be
repeated.  Names and values are strings.  Leading and trailing
whitespace in names and values is not significant.  Neither element
names nor element values may be empty.  (When updating an identifier,
an uploaded empty value is treated as a command to delete the element
entirely.)</p>
<p>Metadata dictionaries are serialized using a subset of <a class="reference external" href="https://ia902903.us.archive.org/25/items/ark_13030_c7x921j3h/anvlspec_2005.pdf">A Name-Value
Language (ANVL)</a> <span class="ext-icon"></span> rules:</p>
<ul class="simple">
<li>One element name/value pair per line.</li>
<li>Names separated from values by colons.</li>
</ul>
<p>For example:</p>
<pre class="literal-block">
who: Proust, Marcel
what: Remembrance of Things Past
when: 1922
</pre>
<p>In addition, two ANVL features may be used when uploading metadata to
EZID (but clients can safely assume that EZID will never use these
features when returning metadata):</p>
<ul class="simple">
<li>A line beginning with a number sign (&quot;#&quot;, U+0023) is a comment and
will be ignored.</li>
<li>A line beginning with whitespace continues the previous line (the
intervening line terminator and whitespace are converted to a single
space).</li>
</ul>
<p>For example:</p>
<pre class="literal-block">
# The following two elements are identical:
who: Proust,
  Marcel
who: Proust, Marcel
</pre>
<p>Care must be taken to escape structural characters that appear in
element names and values, specifically, line terminators (both
newlines (&quot;\n&quot;, U+000A) and carriage returns (&quot;\r&quot;, U+000D)) and, in
element names, colons (&quot;:&quot;, U+003A).  EZID employs <a class="reference external" href="http://en.wikipedia.org/wiki/Percent-encoding">percent-encoding</a>
<span class="ext-icon"></span> as the escaping mechanism, and thus percent signs (&quot;%&quot;,
U+0025) must be escaped as well.  In Python, a dictionary of Unicode
metadata element names and values, <span class="hl1">metadata</span>, is serialized into
a UTF-8 encoded string, <span class="hl1">anvl</span>, with the following code:</p>
<pre class="literal-block">
import re

def escape (s):
  return re.sub(&quot;[%:\r\n]&quot;, lambda c: &quot;%%%02X&quot; % ord(c.group(0)), s)

<span class="hl2">anvl</span> = &quot;\n&quot;.join(&quot;%s: %s&quot; % (escape(name), escape(value)) for name,
  value in <span class="hl2">metadata</span>.items()).encode(&quot;UTF-8&quot;)
</pre>
<p>Conversely, to parse a UTF-8 encoded string, <span class="hl1">anvl</span>, producing
a dictionary, <span class="hl1">metadata</span>:</p>
<pre class="literal-block">
import re

def unescape (s):
  return re.sub(&quot;%([0-9A-Fa-f][0-9A-Fa-f])&quot;,
    lambda m: chr(int(m.group(1), 16)), s)

<span class="hl2">metadata</span> = dict(tuple(unescape(v).strip() for v in l.split(&quot;:&quot;, 1)) \
  for l in <span class="hl2">anvl</span>.decode(&quot;UTF-8&quot;).splitlines())
</pre>
<p>In Java, to serialize a HashMap of metadata element names and values,
<span class="hl1">metadata</span>, into an ANVL-formatted Unicode string, <span class="hl1">anvl</span>:</p>
<pre class="literal-block">
import java.util.*;

String escape (String s) {
  return s.replace(&quot;%&quot;, &quot;%25&quot;).replace(&quot;\n&quot;, &quot;%0A&quot;).
    replace(&quot;\r&quot;, &quot;%0D&quot;).replace(&quot;:&quot;, &quot;%3A&quot;);
}

Iterator&lt;Map.Entry&lt;String, String&gt;&gt; i = <span class="hl2">metadata</span>.entrySet().iterator();
StringBuffer b = new StringBuffer();
while (i.hasNext()) {
  Map.Entry&lt;String, String&gt; e = i.next();
  b.append(escape(e.getKey()) + &quot;: &quot; + escape(e.getValue()) + &quot;\n&quot;);
}
String <span class="hl2">anvl</span> = b.toString();
</pre>
<p>And conversely, to parse a Unicode ANVL-formatted string, <span class="hl1">anvl</span>,
producing a HashMap, <span class="hl1">metadata</span>:</p>
<pre class="literal-block">
import java.util.*;

String unescape (String s) {
  StringBuffer b = new StringBuffer();
  int i;
  while ((i = s.indexOf(&quot;%&quot;)) &gt;= 0) {
    b.append(s.substring(0, i));
    b.append((char) Integer.parseInt(s.substring(i+1, i+3), 16));
    s = s.substring(i+3);
  }
  b.append(s);
  return b.toString();
}

HashMap&lt;String, String&gt; <span class="hl2">metadata</span> = new HashMap&lt;String, String&gt;();
for (String l : <span class="hl2">anvl</span>.split(&quot;[\\r\\n]+&quot;)) {
  String[] kv = l.split(&quot;:&quot;, 2);
  metadata.put(unescape(kv[0]).trim(), unescape(kv[1]).trim());
}
</pre>
<p>The first line of an EZID response body is a status indicator
consisting of &quot;success&quot; or &quot;error&quot;, followed by a colon, followed by
additional information.  Two examples:</p>
<pre class="literal-block">
success: ark:/99999/fk4test
error: bad request - no such identifier
</pre>
</div>
<div class="section" id="error-reporting">
<h1>Error reporting</h1>
<p>An error is indicated by both an HTTP status code and an error status
line of the form &quot;error: <span class="hl1">reason</span>&quot;.  For example:</p>
<pre class="literal-block">
⇒ GET /id/ark:/99999/bogus HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 400 BAD REQUEST
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 39
⇐
⇐ error: bad request - no such identifier
</pre>
<p>Some programming libraries make it a little difficult to read the
content following an error status code.  For example, from Java, it is
necessary to explicitly switch between the input and error streams
based on the status code:</p>
<pre class="literal-block">
java.net.HttpURLConnection c;
java.io.InputStream s;
...
if (c.getResponseCode() &lt; 400) {
  s = c.getInputStream();
} else {
  s = c.getErrorStream();
}
// read from s...
</pre>
</div>
<div class="section" id="operation-get-identifier-metadata">
<h1>Operation: get identifier metadata</h1>
<p>Metadata can be retrieved for any existing identifier; no
authentication is required.  Simply issue a GET request to the
identifier's EZID URL.  Here is a sample interaction:</p>
<pre class="literal-block">
⇒ GET /id/ark:/99999/fk4cz3dh0 HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 208
⇐
⇐ success: ark:/99999/fk4cz3dh0
⇐ _created: 1300812337
⇐ _updated: 1300913550
⇐ _target: http://www.gutenberg.org/ebooks/7178
⇐ _profile: erc
⇐ erc.who: Proust, Marcel
⇐ erc.what: Remembrance of Things Past
⇐ erc.when: 1922
</pre>
<p>The first line of the response body is a status line.  Assuming
success (see <a class="reference internal" href="#error-reporting">Error reporting</a> above), the remainder of the status
line echoes the canonical form of the requested identifier.</p>
<p>The remaining lines are metadata element name/value pairs serialized
per ANVL rules; see <a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a> above.  The order of
elements is undefined.  Element names beginning with an underscore
(&quot;_&quot;, U+005F) are reserved for use by EZID; their meanings are
described in <a class="reference internal" href="#internal-metadata">Internal metadata</a> below.  Some elements may be drawn
from citation metadata standards; see <a class="reference internal" href="#metadata-profiles">Metadata profiles</a> below.</p>
<p>EZID also supports a more flexible identifier lookup operation; see
<a class="reference internal" href="#suffix-passthrough-prefix-matching">Suffix passthrough / prefix matching</a> below.</p>
</div>
<div class="section" id="operation-create-identifier">
<h1>Operation: create identifier</h1>
<p>An identifier can be &quot;created&quot; by sending a PUT request to the
identifier's EZID URL.  Here, identifier creation means establishing a
record of the identifier in EZID (to be successful, no such record can
already exist).  Authentication is required, and the user must have
permission to create identifiers in the namespace (or &quot;shoulder&quot;)
named by the identifier's prefix.  Users can view the namespaces
available to them by visiting the EZID UI and navigating to the Create
ID tab.  For example, if the user has permission to create identifiers
in the general EZID ARK (ark:/13030/c7) namespace, then the user may
create identifiers beginning with &quot;ark:/13030/c7&quot;.</p>
<p>A request body is optional; if present, it defines the identifier's
starting metadata.  There are no restrictions on what metadata
elements can be submitted, but a convention has been established for
naming metadata elements, and EZID has built-in support for certain
sets of metadata elements; see <a class="reference internal" href="#metadata-profiles">Metadata profiles</a> below.  A few of
the internal EZID metadata elements may be set; see <a class="reference internal" href="#internal-metadata">Internal
metadata</a> below.</p>
<p>Here's a sample interaction creating an ARK identifier:</p>
<pre class="literal-block">
⇒ PUT /id/ark:/99999/fk4test HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Content-Type: text/plain; charset=UTF-8
⇒ Content-Length: 30
⇒
⇒ _target: http://www.cdlib.org/

⇐ HTTP/1.1 201 CREATED
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 27
⇐
⇐ success: ark:/99999/fk4test
</pre>
<p>The return is a status line.  The normalized form of the identifier is
returned as shown above, but if a DOI was created, the status line
also includes, separated by a pipe character (&quot;|&quot;, U+007C), the
identifier's &quot;shadow ARK&quot; (an ARK identifier that is an alias for the
created identifier; deprecated).  Note that different identifier
schemes have different normalization rules (e.g., DOIs are normalized
to all uppercase letters).  Here's a sample interaction creating a DOI
identifier:</p>
<pre class="literal-block">
⇒ PUT /id/doi:10.9999/test HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 201 CREATED
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 43
⇐
⇐ success: doi:10.9999/TEST | ark:/b9999/test
</pre>
</div>
<div class="section" id="operation-mint-identifier">
<h1>Operation: mint identifier</h1>
<p>Minting an identifier is the same as creating an identifier, but
instead of supplying a complete identifier, the client specifies only
a namespace (or &quot;shoulder&quot;) that forms the identifier's prefix, and
EZID generates an opaque, random string for the identifier's suffix.
An identifier can be minted by sending a POST request to the URL
https://ezid.cdlib.org/shoulder/<span class="hl1">shoulder</span> where <span class="hl1">shoulder</span>
is the desired namespace.  For example:</p>
<pre class="literal-block">
⇒ POST /shoulder/<span class="hl2">ark:/13030/c7</span> HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Content-Type: text/plain; charset=UTF-8
⇒ Content-Length: 30
⇒
⇒ _target: http://www.cdlib.org/

⇐ HTTP/1.1 201 CREATED
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 29
⇐
⇐ success: <span class="hl2">ark:/13030/c7</span>9cz3dh0
</pre>
<p>Aside from specifying a complete identifier versus specifying a
shoulder only, the create and mint operations operate identically.
Authentication is required to mint an identifier; namespace permission
is required; and permissions can be viewed in the EZID UI under the
Create ID tab.  The request and response bodies are identical.</p>
<p>EZID automatically embeds the newly-minted identifier in certain types
of uploaded metadata.  See <a class="reference internal" href="#metadata-profiles">Metadata profiles</a> below for when this is
performed.  Additionally, EZID replaces all occurrences of the string
&quot;${identifier}&quot; in the target URL with the newly-minted identifier.</p>
</div>
<div class="section" id="operation-update-identifier">
<h1>Operation: update identifier</h1>
<p>An identifier's metadata can be updated by sending a POST request to
the identifier's EZID URL.  Authentication is required; only the
identifier's owner and certain other users may update the identifier
(see <a class="reference internal" href="#ownership-model">Ownership model</a> below).</p>
<p>Metadata elements are operated on individually.  If the identifier
already has a value for a metadata element included in the request
body, the value is overwritten, otherwise the element and its value
are added.  Only a few of the reserved EZID metadata elements may be
updated; see <a class="reference internal" href="#internal-metadata">Internal metadata</a> below.  Here's a sample interaction:</p>
<pre class="literal-block">
⇒ POST /id/ark:/99999/fk4cz3dh0 HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Content-Type: text/plain; charset=UTF-8
⇒ Content-Length: 30
⇒
⇒ _target: http://www.cdlib.org/

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 29
⇐
⇐ success: ark:/99999/fk4cz3dh0
</pre>
<p>The return is a status line.  Assuming success (see <a class="reference internal" href="#error-reporting">Error reporting</a>
above), the remainder of the status line echoes the canonical form of
the identifier in question.</p>
<p>To delete a metadata element, set its value to the empty string.</p>
</div>
<div class="section" id="operation-create-or-update-identifier">
<h1>Operation: create or update identifier</h1>
<p>An identifier can be created or updated in one interaction; the
specific operation performed will depend on whether the identifier
already exists or not.  To do so, issue a create operation as
described under <a class="reference internal" href="#operation-create-identifier">Operation: create identifier</a> above, but add an
update_if_exists=yes URL query parameter to the PUT request.  EZID
returns a 201 HTTP status code if the identifier was created or a 200
HTTP status code if the identifier already existed and was
successfully updated.  The response body is a status line as described
previously.  Here's a sample request:</p>
<pre class="literal-block">
⇒ PUT /id/ark:/99999/fk4test?update_if_exists=yes HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Content-Type: text/plain; charset=UTF-8
⇒ Content-Length: 30
⇒
⇒ _target: http://www.cdlib.org/
</pre>
</div>
<div class="section" id="operation-delete-identifier">
<h1>Operation: delete identifier</h1>
<p>An identifier that has only been reserved can be deleted by sending a
DELETE request to the identifier's EZID URL.  We emphasize that only
<em>reserved</em> identifiers may be deleted; see <a class="reference internal" href="#identifier-status">Identifier status</a> below.
Authentication is required; only the identifier's owner and certain
other users may delete the identifier (see <a class="reference internal" href="#ownership-model">Ownership model</a> below).</p>
<p>Here's a sample interaction:</p>
<pre class="literal-block">
⇒ DELETE /id/ark:/99999/fk4cz3dh0 HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 29
⇐
⇐ success: ark:/99999/fk4cz3dh0
</pre>
<p>The return is a status line.  Assuming success (see <a class="reference internal" href="#error-reporting">Error reporting</a>
above), the remainder of the status line echoes the canonical form of
the identifier just deleted.</p>
</div>
<div class="section" id="suffix-passthrough-prefix-matching">
<h1>Suffix passthrough / prefix matching</h1>
<p>The <a class="reference external" href="https://n2t.net/">N2T</a> <span class="ext-icon"></span> resolver—the principal resolver for
ARK identifiers—supports &quot;suffix passthrough,&quot; a capability
that allows an identifier to be resolved even if it has not been
explicitly registered, so long as some prefix of the identifier has.
In such a case, N2T locates the longest matching prefix (the &quot;root&quot;
identifier) and appends the extra characters in the supplied
identifier (the &quot;suffix&quot;) to the root identifier's target URL before
redirecting.  For example, if identifier ark:/99999/fk4/root has been
registered with EZID and has target URL http://www.cdlib.org, then N2T
resolves ark:/99999/fk4/root<span class="hl1">/andmore</span> to
http://www.cdlib.org<span class="hl1">/andmore</span>.  The capability is so-named
because the suffix is effectively &quot;passed through&quot; to the receiving
server.</p>
<p>EZID supports a similar capability.  If a request to view identifier
metadata (see <a class="reference internal" href="#operation-get-identifier-metadata">Operation: get identifier metadata</a> above) is
accompanied by a prefix_match=yes URL query parameter, then EZID
returns metadata for the longest matching identifier (if there is
one).  If an identifier other than the one requested is returned, the
status line includes a note to that effect.  Here is a sample
interaction that continues the previous example:</p>
<pre class="literal-block">
⇒ GET /id/ark:/99999/fk4/root/andmore?prefix_match=yes HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 244
⇐
⇐ success: ark:/99999/fk4/root in_lieu_of ark:/99999/fk4/root/andmore
⇐ _target: http://www.cdlib.org
⇐ ...
</pre>
</div>
<div class="section" id="ownership-model">
<h1>Ownership model</h1>
<p>EZID maintains ownership information about identifiers and uses that
information to enforce access control.</p>
<p>The ownership model employed by EZID is hierarchical: each identifier
has one owner, which is an EZID user; each EZID user belongs to one
group; and each group belongs to one realm.  Permission to create
identifiers is governed by the namespaces (or &quot;shoulders&quot;) that have
been assigned to a user by an EZID administrator.  But once created,
permission to subsequently update an identifier is governed solely by
the identifier's ownership.  An identifier may be updated only by its
owner, with two exceptions:</p>
<ul class="simple">
<li><strong>Proxies</strong>.  A user (the &quot;proxied user&quot;) may name another EZID user
as its &quot;proxy&quot;.  A user may have multiple proxies, and a user may be
a proxy for multiple other users.  Generally speaking, a proxy may
operate on behalf of the proxied user.  Specifically, a proxy may:<ul>
<li>create identifiers under any shoulder available to the proxied
user;</li>
<li>create identifiers owned by the proxied user, by setting the
&quot;_owner&quot; reserved metadata element (see <a class="reference internal" href="#internal-metadata">Internal metadata</a>
below);</li>
<li>update existing identifiers owned by the proxied user;</li>
<li>change the ownership of identifiers owned by the proxied user to
itself or to any other user on whose behalf the proxy may operate,
and vice versa;</li>
<li>search over the proxied user's identifiers;</li>
<li>view statistics regarding the proxied user's identifiers; and</li>
<li>download the proxied user's identifiers (see <a class="reference internal" href="#batch-download">Batch download</a>
below).</li>
</ul>
</li>
<li><strong>Group administrators</strong>.  An EZID user may be appointed an
&quot;administrator&quot; of its group.  A group may have zero, one, or more
than one administrator.  Generally speaking, a group administrator
may operate on behalf of any other member of the group;
equivalently, a group administrator is a proxy for the group's
members, and as such its specific abilities include the list given
above.  In addition, a group administrator may:<ul>
<li>search over all the group's identifiers;</li>
<li>view group-level identifier statistics; and</li>
<li>download all the group's identifiers.</li>
</ul>
</li>
</ul>
<p>Proxies can be set up and managed in the EZID UI, Account Settings
tab.  Group administrators can be appointed only by an EZID
administrator.</p>
<p>Proxies and group administrators are independent concepts.  A group
administrator may also be a proxy, and may also have proxies.</p>
</div>
<div class="section" id="identifier-status">
<h1>Identifier status</h1>
<p>Each identifier in EZID has a status.  The status is recorded as the
value of the &quot;_status&quot; reserved metadata element (see <a class="reference internal" href="#internal-metadata">Internal
metadata</a> below) and may be one of:</p>
<dl class="docutils">
<dt><strong>public</strong></dt>
<dd>The default value.</dd>
<dt><strong>reserved</strong></dt>
<dd>The identifier is known only to EZID.  This status may be used to
reserve an identifier name within EZID without advertising the
identifier's existence to resolvers and other external services.  A
reserved identifier may be deleted.</dd>
<dt><strong>unavailable</strong></dt>
<dd>The identifier is public, but the object referenced by the
identifier is not available.  A reason for the object's
unavailability may optionally follow the status separated by a pipe
character (&quot;|&quot;, U+007C), e.g., &quot;unavailable | withdrawn by author&quot;.
The identifier redirects to an EZID-provided &quot;tombstone&quot; page (an
HTML page that displays the identifier's citation metadata and the
reason for the object's unavailability) regardless of its target
URL.</dd>
</dl>
<p>An identifier's status may be changed by setting a new value for the
aforementioned &quot;_status&quot; metadata element.  EZID permits only certain
status transitions:</p>
<ul class="simple">
<li>A status of &quot;reserved&quot; may be specified only at identifier
creation time.</li>
<li>A reserved identifier may be made public.  At this time the
identifier will be registered with resolvers and other external
services.</li>
<li>A public identifier may be marked as unavailable.  At this time the
identifier will be removed from resolvers and external services to
the extent possible.</li>
<li>An unavailable identifier may be returned to public status.  At this
time the identifier will be re-registered with resolvers and other
external services.</li>
</ul>
</div>
<div class="section" id="internal-metadata">
<h1>Internal metadata</h1>
<p>Metadata element names beginning with an underscore (&quot;_&quot;, U+005F) are
reserved for use by EZID.  The reserved elements below are returned by
the EZID API, and have the following meanings.  A check mark in the
first column indicates the element is updatable by clients.</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="15%" />
<col width="59%" />
<col width="22%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">✓</th>
<th class="head">Element</th>
<th class="head">Definition</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>✓</td>
<td>_owner</td>
<td>The identifier's owner.  Only certain
ownership changes are permitted; see
<a class="reference internal" href="#ownership-model">Ownership model</a> above.</td>
<td>jsmith</td>
</tr>
<tr><td></td>
<td>_ownergroup</td>
<td>The identifier's owning group, which is
currently restricted to be the identifier's
owner's group.</td>
<td>ucla</td>
</tr>
<tr><td></td>
<td>_created</td>
<td>The time the identifier was created
expressed as a Unix timestamp.</td>
<td>1300812337</td>
</tr>
<tr><td></td>
<td>_updated</td>
<td>The time the identifier was last updated
expressed as a Unix timestamp.</td>
<td>1300913550</td>
</tr>
<tr><td>✓</td>
<td>_target</td>
<td colspan="2">The identifier's target URL.  Defaults to the identifier's
EZID URL.  That is, the default target URL for identifier
<span class="hl1">foo</span> is the self-referential URL
https://ezid.cdlib.org/id/<span class="hl1">foo</span>.  Note that creating or
updating the target URL of a DOI identifier may take up to
30 minutes to take effect in the Handle System.</td>
</tr>
<tr><td>✓</td>
<td>_profile</td>
<td>The identifier's preferred metadata profile
(see <a class="reference internal" href="#metadata-profiles">Metadata profiles</a> next).</td>
<td>erc</td>
</tr>
<tr><td>✓</td>
<td>_status</td>
<td>The identifier's status (see
<a class="reference internal" href="#identifier-status">Identifier status</a> above).</td>
<td>unavailable |
withdrawn by
author</td>
</tr>
<tr><td>✓</td>
<td>_export</td>
<td>Determines if the identifier is publicized
by exporting it to external indexing and
harvesting services.  Must be &quot;yes&quot; or &quot;no&quot;;
defaults to &quot;yes&quot;.</td>
<td>yes</td>
</tr>
<tr><td></td>
<td>_datacenter</td>
<td>DataCite DOIs only.  The datacenter at which
the identifier is registered (or will be
registered, in the case of a reserved
identifier).</td>
<td>CDL.CDL</td>
</tr>
<tr><td>✓</td>
<td>_crossref</td>
<td>If returned, indicates that the identifier
is registered with Crossref (or, in the case
of a reserved identifier, will be
registered), and also indicates the status
of the registration process.  When setting,
must be set to &quot;yes&quot;.  See
<a class="reference internal" href="#crossref-registration">Crossref registration</a> below for more
information.</td>
<td>yes |
successfully
registered</td>
</tr>
</tbody>
</table>
</blockquote>
</div>
<div class="section" id="metadata-profiles">
<h1>Metadata profiles</h1>
<p>EZID allows &quot;citation metadata&quot; to be stored with an identifier, i.e.,
metadata that describes the object referenced by the identifier or
that otherwise gives the meaning of the identifier.  In certain cases
certain metadata elements are required to be present; see <a class="reference internal" href="#metadata-requirements-mapping">Metadata
requirements &amp; mapping</a> below.  This section describes only the
general structure and naming of citation metadata in EZID.</p>
<p>EZID supports several citation metadata &quot;profiles,&quot; or standard sets
of citation metadata elements.  By convention, a metadata profile is
referred to using a simple, lowercase name, e.g., &quot;erc&quot;, and elements
belonging to that profile are referred to using the syntax
&quot;<span class="hl1">profile</span>.<span class="hl1">element</span>&quot;, e.g., &quot;erc.who&quot;.</p>
<p>Currently EZID treats profiles entirely separately, and thus an
identifier may have values for multiple metadata profiles
simultaneously.  However, we anticipate that EZID will provide
metadata cross-walking in the future, in which case setting a value
for an element in one profile will automatically provide a value for
equivalent elements in other profiles.  For this reason, clients are
encouraged to pick one profile to populate per identifier.</p>
<p>The &quot;_profile&quot; internal metadata element defines the identifier's
preferred metadata profile (typically the only profile for which it
has metadata).  There is no restriction on what metadata elements may
be bound to an identifier, and hence clients are free to use alternate
citation profiles or no citation profile at all.  However, EZID's UI
is, and its future metadata cross-walking support will be, limited to
those profiles that it explicitly supports.</p>
<ol class="arabic simple" id="profile-erc">
<li><strong>Profile &quot;erc&quot;</strong>.  These elements are drawn from <a class="reference external" href="https://arks.org/specs/">Kernel Metadata
and Electronic Resource Citations (ERCs)</a> <span class="ext-icon"></span>.  This
profile aims at universal citations: any kind of object (digital,
physical, abstract) or agent (person, group, software, satellite)
for any purpose (research, education, entertainment,
administration), any subject focus (oceanography, sales, religion,
archiving), and any medium (television, newspaper, database, book).
This is the default profile for ARK and UUID identifiers.</li>
</ol>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="12%" />
<col width="88%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Element</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>erc.who</td>
<td><p class="first">The name of an entity (person, organization, or service)
responsible for creating the content or making it
available.  For an article, this could be an author.  Put
name parts in &quot;sort-friendly&quot; order, such as:</p>
<ul class="simple">
<li>van Gogh, Vincent,</li>
<li>Hu Jintao</li>
<li>Gilbert, William, Sir,,; Sullivan, Arthur, Sir,</li>
</ul>
<p class="last">Separate multiple names with &quot;;&quot;.  Append one or more final
commas (&quot;,&quot;) to indicate that one or more internal commas
can be used as inversion points to recover natural word
order (if different from sort-friendly word order).</p>
</td>
</tr>
<tr><td>erc.what</td>
<td><p class="first">A name or other human-oriented identifier given to the
resource.  For an article, this could be a title such
as:</p>
<ul class="simple">
<li>Moby Dick</li>
<li>Scarlet Pimpernel, The,</li>
</ul>
<p class="last">Use sort-friendly name parts and final commas in the same
way as for the erc.who element.</p>
</td>
</tr>
<tr><td>erc.when</td>
<td><p class="first">A point or period of time important in the lifecycle of the
resource, often when it was created, modified, or made
available.  For an article, this could be the date it was
written, such as:</p>
<ul class="simple">
<li>2009.04.23</li>
<li>1924~</li>
<li>BCE0386</li>
<li>1998-2003; 2008-</li>
</ul>
<p class="last">A date range (which can be open ended) may be useful, such
as to indicate the years during which a periodical
operated.  Use &quot;;&quot; to separate entries and &quot;~&quot; to indicate
approximation.</p>
</td>
</tr>
</tbody>
</table>
<p>As a special case, an entire <a class="reference external" href="https://wiki.ucop.edu/display/Curation/Anvl">ANVL</a> <span class="ext-icon"></span> document
containing ERC metadata may be bound to the metadata element &quot;erc&quot;.
Care should be taken to escape line terminators in the document (as
is true for all metadata element values; see <a class="reference internal" href="#request-response-bodies">Request &amp; response
bodies</a> above).  For example, the ANVL document:</p>
<pre class="literal-block">
who: Proust, Marcel
what: Remembrance of Things Past
</pre>
<p>would be expressed as the single value:</p>
<pre class="literal-block">
erc: who: Proust, Marcel%0Awhat: Remembrance of Things Past
</pre>
</blockquote>
<ol class="arabic simple" id="profile-datacite" start="2">
<li><strong>Profile &quot;datacite&quot;</strong>.  These elements are drawn from the
<a class="reference external" href="http://schema.datacite.org/">DataCite Metadata Scheme for the Publication and Citation of
Research Data</a> <span class="ext-icon"></span>.  This is the default profile for
DOI identifiers.</li>
</ol>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="36%" />
<col width="64%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Element</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>datacite.creator</td>
<td><p class="first">The main researchers involved in producing
the data, or the authors of the publication
in priority order.  Each name may be a
corporate, institutional, or personal name.
In personal names list family name before
given name, as in:</p>
<ul class="simple">
<li>Shakespeare, William</li>
</ul>
<p class="last">Separate multiple names with &quot;;&quot;.
Non-roman names should be transliterated
according to the ALA-LC schemes.</p>
</td>
</tr>
<tr><td>datacite.title</td>
<td>A name or title by which the data or
publication is known.</td>
</tr>
<tr><td>datacite.publisher</td>
<td>A holder of the data (e.g., an archive) or
the institution which submitted the work.
In the case of datasets, the publisher is
the entity primarily responsible for making
the data available to the research
community.</td>
</tr>
<tr><td>datacite.publicationyear</td>
<td>The year when the data was or will be made
publicly available.  If an embargo period
is in effect, use the year when the embargo
period ends.</td>
</tr>
<tr><td>datacite.resourcetype</td>
<td><p class="first">The general type and, optionally, specific
type of the data.  The general type must
be one of the controlled vocabulary terms
defined in the DataCite Metadata Scheme:</p>
<ul class="simple">
<li>Audiovisual</li>
<li>Collection</li>
<li>Dataset</li>
<li>Event</li>
<li>Image</li>
<li>InteractiveResource</li>
<li>Model</li>
<li>PhysicalObject</li>
<li>Service</li>
<li>Software</li>
<li>Sound</li>
<li>Text</li>
<li>Workflow</li>
<li>Other</li>
</ul>
<p>Specific types are unconstrained.  If a
specific type is given, it must be
separated from the general type by a
forward slash (&quot;/&quot;), as in:</p>
<ul class="last simple">
<li>Image/Photograph</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Alternatively, an entire XML document adhering to the DataCite
Metadata Scheme schema may be bound to the metadata element
&quot;datacite&quot;.  Note that EZID sets the identifier embedded in the
document to the identifier being operated on; thus it need not be
specified by the client.  The &lt;identifier&gt; element must still be
included in the document, though, so the XML document may resemble:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;resource xmlns=&quot;http://datacite.org/schema/kernel-4&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;...&quot;&gt;
  &lt;identifier identifierType=&quot;DOI&quot;&gt;(:tba)&lt;/identifier&gt;
  ...
&lt;/resource&gt;
</pre>
<p>If an XML document is bound to a non-DOI identifier then, in an
extension to the DataCite schema, the identifier type in the
document must be set to &quot;ARK&quot; or &quot;UUID&quot; as appropriate.</p>
<p>Care should be taken to escape line terminators and percent signs
in the document (as is true for all metadata element values; see
<a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a> above).  Once properly escaped, the
uploaded metadata will resemble:</p>
<pre class="literal-block">
datacite: &lt;?xml version=&quot;1.0&quot;?&gt;%0A&lt;resource...
</pre>
</blockquote>
<ol class="arabic simple" id="profile-dc" start="3">
<li><strong>Profile &quot;dc&quot;</strong>.  These elements are drawn from the <a class="reference external" href="http://dublincore.org/documents/dces/">Dublin Core
Metadata Element Set</a> <span class="ext-icon"></span>.</li>
</ol>
<!--  -->
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="18%" />
<col width="82%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Element</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>dc.creator</td>
<td>An entity primarily responsible for making the content
of the resource.  Examples of a Creator include a
person, an organization, or a service.  Typically, the
name of a Creator should be used to indicate the
entity.</td>
</tr>
<tr><td>dc.title</td>
<td>A name given to the resource.  Typically, a Title will
be a name by which the resource is formally known.</td>
</tr>
<tr><td>dc.publisher</td>
<td>An entity responsible for making the resource
available.  Examples of a Publisher include a person,
an organization, or a service.  Typically, the name of
a Publisher should be used to indicate the entity.</td>
</tr>
<tr><td>dc.date</td>
<td>A date associated with an event in the life cycle of
the resource.  Typically, Date will be associated with
the creation or availability of the resource.
Recommended best practice for encoding the date value
is defined in a profile of ISO 8601 and follows the
YYYY-MM-DD format.</td>
</tr>
<tr><td>dc.type</td>
<td><p class="first">The nature or genre of the resource.  Recommended best
practice is to use a term from the DCMI Type
Vocabulary:</p>
<ul class="last simple">
<li>Collection</li>
<li>Dataset</li>
<li>Event</li>
<li>Image</li>
<li>InteractiveResource</li>
<li>MovingImage</li>
<li>PhysicalObject</li>
<li>Service</li>
<li>Software</li>
<li>Sound</li>
<li>StillImage</li>
<li>Text</li>
</ul>
</td>
</tr>
</tbody>
</table>
</blockquote>
<p id="profile-crossref">4. <strong>Profile &quot;crossref&quot;</strong>.  This profile consists of a single element,
&quot;crossref&quot;, whose value is Crossref deposit metadata (an XML
document).  Care should be taken to escape line terminators and
percent signs in the document (as is true for all metadata element
values; see <a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a> above).  See <a class="reference internal" href="#crossref-registration">Crossref
registration</a> below for more information on usage of this profile and
element.</p>
</div>
<div class="section" id="metadata-requirements-mapping">
<h1>Metadata requirements &amp; mapping</h1>
<p>DOI identifiers must satisfy specific metadata requirements.  A
DataCite DOI created by EZID must have title, creator, publisher, and
publication year metadata any time its status is not reserved (see
<a class="reference internal" href="#identifier-status">Identifier status</a> above).  A Crossref DOI must have Crossref
metadata at all times (see <a class="reference internal" href="#crossref-registration">Crossref registration</a> below), though the
metadata need not be complete if the identifier is reserved.  Other
than that, EZID imposes no requirements on the presence or form of
citation metadata, but uploading at least minimal citation metadata to
EZID is strongly encouraged in all cases to record the identifier's
meaning and to facilitate its long-term maintenance.  Regardless of
the metadata profile used, population of the &quot;datacite.resourcetype&quot;
element is encouraged to support broad categorization of identifiers.</p>
<p>To satisfy the aforementioned DataCite DOI metadata requirements, EZID
looks in order for:</p>
<ol class="arabic simple">
<li>DataCite XML metadata bound to the &quot;datacite&quot; element;</li>
<li>Individual elements from the &quot;datacite&quot; profile as described in
<a class="reference internal" href="#profile-datacite">Profile &quot;datacite&quot;</a> (&quot;datacite.title&quot;, etc.); and lastly</li>
<li>Elements from the identifier's preferred metadata profile (see
<a class="reference internal" href="#metadata-profiles">Metadata profiles</a> above) that EZID is able to map to DataCite
equivalents.  For example, if the preferred profile is &quot;erc&quot;, then
EZID will map element &quot;erc.who&quot; to &quot;datacite.creator&quot;.</li>
</ol>
<p>If no meaningful value is available for a required element, clients
are encouraged to supply a standard machine-readable code drawn from
the <a class="reference external" href="https://wiki.ucop.edu/display/Curation/ERC">Kernel Metadata and Electronic Resource Citations (ERCs)</a>
<span class="ext-icon"></span> specification.  These codes have the common syntactic
form &quot;(:<span class="hl1">code</span>)&quot; and include:</p>
<blockquote>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="87%" />
</colgroup>
<thead valign="bottom">
<tr><th class="head">Code</th>
<th class="head">Definition</th>
</tr>
</thead>
<tbody valign="top">
<tr><td>(:unac)</td>
<td>temporarily inaccessible</td>
</tr>
<tr><td>(:unal)</td>
<td>unallowed; intentionally suppressed</td>
</tr>
<tr><td>(:unap)</td>
<td>not applicable; makes no sense</td>
</tr>
<tr><td>(:unas)</td>
<td>unassigned (e.g., untitled)</td>
</tr>
<tr><td>(:unav)</td>
<td>unavailable; possibly unknown</td>
</tr>
<tr><td>(:unkn)</td>
<td>known to be unknown (e.g., anonymous)</td>
</tr>
<tr><td>(:none)</td>
<td>never had a value, never will</td>
</tr>
<tr><td>(:null)</td>
<td>explicitly and meaningfully empty</td>
</tr>
<tr><td>(:tba)</td>
<td>to be assigned or announced later</td>
</tr>
<tr><td>(:etal)</td>
<td>too numerous to list (et alia)</td>
</tr>
<tr><td>(:at)</td>
<td>the real value is at the given URL or identifier</td>
</tr>
</tbody>
</table>
</blockquote>
<p>A code may optionally be followed by the code's human-readable
equivalent or a more specific description, as in:</p>
<pre class="literal-block">
who: (:unkn) anonymous donor
</pre>
</div>
<div class="section" id="crossref-registration">
<h1>Crossref registration</h1>
<p>A DOI identifier may be registered with either the <a class="reference external" href="http://www.crossref.org/">Crossref</a> <span class="ext-icon"></span> or the <a class="reference external" href="http://www.datacite.org/">DataCite</a> <span class="ext-icon"></span> registration agency.
The choice of registration agency is not selectable, but is entirely
determined by the identifier's shoulder.  This section discusses
registration with Crossref.</p>
<p>Once registered, an identifier cannot be removed from Crossref.  If
the identifier's status is set to unavailable (recall <a class="reference internal" href="#identifier-status">Identifier
status</a>, above), EZID will prepend &quot;WITHDRAWN&quot; to the title of the
resource associated with the identifier, but the identifier remains in
Crossref's systems.</p>
<p>Registering an identifier with Crossref requires three steps:</p>
<ol class="arabic simple">
<li>Optionally set the &quot;_crossref&quot; reserved metadata element to &quot;yes&quot;.</li>
<li>Supply Crossref deposit metadata as the value of the &quot;crossref&quot;
element.</li>
<li>Set the &quot;_profile&quot; reserved metadata element to &quot;crossref&quot; to be
able to view the metadata in the EZID UI.</li>
</ol>
<p>These steps are discussed in more detail next.</p>
<p>Crossref registration is asynchronous.  Registration is initiated by a
create, mint, or update identifier request, when the identifier's
status is public.  Setting the &quot;_crossref&quot; reserved metadata element
to &quot;yes&quot; in the request is optional.  In responses, the &quot;_crossref&quot;
element is always returned and has the value &quot;yes&quot; followed by a pipe
character (&quot;|&quot;, U+007C) followed by the status of the registration,
e.g., &quot;yes | registration in progress&quot; or &quot;yes | successfully
registered&quot;.  The status of the registration is updated automatically
by EZID and may be polled by the client.  If a warning or error
occurred during registration, the status is followed by another pipe
character and the message received from Crossref, e.g., &quot;yes |
registration failure | xml error...&quot;.  Warnings and errors may also be
viewed in the EZID UI and may also be emailed to a specified mailbox.
Warnings and errors can be removed only by submitting new metadata and
re-registering identifiers.</p>
<p>Crossref deposit metadata should adhere to the <a class="reference external" href="https://www.crossref.org/documentation/schema-library/">Crossref Deposit
Schema</a> <span class="ext-icon"></span>, version 4.3.0 or later.  The metadata should
consist of the immediate child element of a &lt;body&gt; element, i.e., one
of the following elements:</p>
<ul class="simple">
<li>&lt;journal&gt;</li>
<li>&lt;book&gt;</li>
<li>&lt;conference&gt;</li>
<li>&lt;sa_component&gt;</li>
<li>&lt;dissertation&gt;</li>
<li>&lt;report-paper&gt;</li>
<li>&lt;standard&gt;</li>
<li>&lt;database&gt;</li>
</ul>
<p>(If an outer element such as &lt;doi_batch&gt; or &lt;body&gt; is nevertheless
supplied, it will be stripped off.)</p>
<p>Although the Crossref deposit schema is quite flexible, and supports
batch operations, EZID requires that the deposit metadata specify a
single DOI identifier, i.e., a single &lt;doi_data&gt; element.  This
element should contain &lt;doi&gt; and &lt;resource&gt; subelements, which may be
left empty.  EZID replaces the contents of the &lt;doi&gt; element (if any)
with the identifier in question and the contents of the &lt;resource&gt;
element with the target URL.  Here is an abridged example of deposit
metadata:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;book xmlns=&quot;http://www.crossref.org/schema/4.3.4&quot;
  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;
  xsi:schemaLocation=&quot;http://www.crossref.org/schema/4.3.4
  http://www.crossref.org/schema/deposit/crossref4.3.4.xsd&quot;
  book_type=&quot;monograph&quot;&gt;
  &lt;book_metadata&gt;
    &lt;contributors&gt;
      &lt;person_name contributor_role=&quot;author&quot; sequence=&quot;first&quot;&gt;
        &lt;given_name&gt;Marcel&lt;/given_name&gt;
        &lt;surname&gt;Proust&lt;/surname&gt;
      &lt;/person_name&gt;
    &lt;/contributors&gt;
    &lt;titles&gt;
      &lt;title&gt;Remembrance of Things Past&lt;/title&gt;
    &lt;/titles&gt;
    ...
    &lt;doi_data&gt;
      &lt;doi&gt;(:tba)&lt;/doi&gt;
      &lt;resource&gt;(:tba)&lt;/resource&gt;
    &lt;/doi_data&gt;
  &lt;/book_metadata&gt;
&lt;/book&gt;
</pre>
<p>In supplying an XML document as the value of element &quot;crossref&quot;, care
should be taken to escape line terminators and percent signs in the
document (as is true for all metadata element values; see <a class="reference internal" href="#request-response-bodies">Request &amp;
response bodies</a> above).</p>
<p>If the identifier's preferred metadata profile is &quot;crossref&quot;, EZID
automatically creates a DataCite Metadata Scheme record from the
Crossref deposit metadata for display and search purposes.  Where
conversion values are missing (e.g., a journal does not have a
creator) EZID supplies the code &quot;(:unav)&quot;.  This automatic conversion
can be overriden by supplying an entire DataCite Metadata Scheme XML
record as the value of the &quot;datacite&quot; element (see <a class="reference internal" href="#profile-datacite">Profile
&quot;datacite&quot;</a> above).  Additionally, individual DataCite elements
(e.g., &quot;datacite.title&quot;) may be specified to override selected
portions of the automatic conversion.</p>
<p>Putting it all together, uploaded metadata in a Crossref registration
request will resemble:</p>
<pre class="literal-block">
_crossref: yes
_profile: crossref
_target: http://...
crossref: &lt;?xml version=&quot;1.0&quot;?&gt;%0A&lt;book...
</pre>
</div>
<div class="section" id="testing-the-api">
<h1>Testing the API</h1>
<p>EZID provides three namespaces (or &quot;shoulders&quot;) for testing purposes:
ark:/99999/fk4 for ARK identifiers, doi:10.5072/FK2 for DataCite DOI
identifiers, and doi:10.15697/ for Crossref DOI identifiers.
Identifiers in these namespaces are termed &quot;test identifiers.&quot;  They
are ordinary long-term identifiers in almost all respects, except that
EZID deletes them after 2 weeks.</p>
<p>Test ARK identifiers resolve just as real ARK identifiers do through
the <a class="reference external" href="https://n2t.net/">N2T</a> resolver, but test DOI identifiers do not resolve and do not
appear in any DataCite or Crossref systems.</p>
<p>All user accounts are permitted to create test identifiers.  EZID also
provides an &quot;apitest&quot; account that is permitted to create only test
identifiers.  <a class="reference external" href="/contact">Contact us</a> for the password for this account.
Additionally, please <a class="reference external" href="/contact">contact us</a> before embarking on any large-scale
testing, specifically, before creating more than 10,000 test
identifiers.</p>
<p>Test identifiers and reserved identifiers are orthogonal concepts.  A
test identifier has a limited lifetime and is deleted by EZID when it
expires.  A reserved identifier may be deleted by the owner while
still in its reserved state, but once made public, is permanent.  As
evidence of this orthogonality, it is possible to create reserved test
identifiers.</p>
</div>
<div class="section" id="server-status">
<h1>Server status</h1>
<p>The status of the EZID server can be probed by issuing a GET request
to the URL https://ezid.cdlib.org/status.  If the server is up the
response will resemble the following:</p>
<pre class="literal-block">
⇒ GET /status HTTP/1.1
⇒ Host: ezid.cdlib.org

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 19
⇐
⇐ success: EZID is up
</pre>
</div>
<div class="section" id="python-command-line-tool">
<h1>Python command line tool</h1>
<p><a class="reference external" href="https://github.com/CDLUC3/ezid-client-tools/blob/master/ezid.py">ezid.py</a> <span class="ext-icon"></span> is a command line tool, written in Python,
that is capable of exercising all API functions.  It serves as an
example of how to use the API from Python, but it's also useful in its
own right as an easy, scriptable means of accessing EZID
functionality.  The general usage is:</p>
<pre class="literal-block">
% ezid.py <span class="hl2">credentials</span> <span class="hl2">operation</span> <span class="hl2">[arguments...]</span>
</pre>
<p>Run the tool with no command line arguments for a complete usage
statement; additional documentation is in the source code.  To give a
flavor of the tool's usage and capabilities here, a few examples
follow.</p>
<p>To mint a test ARK identifier and supply initial metadata:</p>
<pre class="literal-block">
% ezid.py <span class="hl2">username</span>:<span class="hl2">password</span> mint ark:/99999/fk4 erc.who 'Proust, Marcel' \
    erc.what 'Remembrance of Things Past' erc.when 1922
success: ark:/99999/fk4gt78tq
</pre>
<p>To get identifier metadata:</p>
<pre class="literal-block">
% ezid.py -dt - view ark:/99999/fk4gt78tq
success: ark:/99999/fk4gt78tq
_created: 2013-05-17T18:17:14
_export: yes
_owner: <span class="hl2">user</span>
_ownergroup: <span class="hl2">group</span>
_profile: erc
_status: public
_target: https://ezid.cdlib.org/id/ark:/99999/fk4gt78tq
_updated: 2013-05-17T18:17:14
erc.what: Remembrance of Things Past
erc.when: 1922
erc.who: Proust, Marcel
</pre>
<p>The tool provides two mechanisms in addition to the command line for
supplying metadata.  If a metadata element name is an at-sign (&quot;&#64;&quot;,
U+0040), the subsequent value is treated as a filename and metadata
elements are read from the named ANVL-formatted file.  For example, if
file metadata.txt contains:</p>
<pre class="literal-block">
erc.who: Proust, Marcel
erc.what: Remembrance of Things Past
erc.when: 1922
</pre>
<p>Then a test ARK identifier with that metadata can be minted by
invoking:</p>
<pre class="literal-block">
% ezid.py <span class="hl2">username</span>:<span class="hl2">password</span> mint ark:/99999/fk4 &#64; metadata.txt
</pre>
<p>And if a metadata element value has the form &quot;&#64;<span class="hl1">filename</span>&quot;, the
named file is read and treated as a single value.  For example, if
file metadata.xml contains a DataCite XML document, then a test DOI
identifier with that document as the value of the &quot;datacite&quot; element
can be minted by invoking:</p>
<pre class="literal-block">
% ezid.py <span class="hl2">username</span>:<span class="hl2">password</span> mint doi:10.5072/FK2 datacite &#64;metadata.xml
</pre>
</div>
<div class="section" id="php-examples">
<h1>PHP examples</h1>
<p>PHP is agnostic with respect to character sets and character set
encoding; it operates on bytes only.  The following examples assume
that input data is already UTF-8 encoded and hence can be passed
directly to EZID; if this is not the case, input data will need to be
converted to UTF-8 using the functions PHP provides for that purpose.</p>
<p>Get identifier metadata:</p>
<pre class="literal-block">
&lt;?php
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'https://ezid.cdlib.org/id/<span class="hl2">identifier</span>');
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$output = curl_exec($ch);
print curl_getinfo($ch, CURLINFO_HTTP_CODE) . &quot;\n&quot;;
print $output . &quot;\n&quot;;
curl_close($ch);
?&gt;
</pre>
<p>Create identifier:</p>
<pre class="literal-block">
&lt;?php
$input = '_target: <span class="hl2">url</span>
<span class="hl2">element1</span>: <span class="hl2">value1</span>
<span class="hl2">element2</span>: <span class="hl2">value2</span>';
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'https://ezid.cdlib.org/id/<span class="hl2">identifier</span>');
curl_setopt($ch, CURLOPT_USERPWD, '<span class="hl2">username</span>:<span class="hl2">password</span>');
curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT');
curl_setopt($ch, CURLOPT_HTTPHEADER,
  array('Content-Type: text/plain; charset=UTF-8',
        'Content-Length: ' . strlen($input)));
curl_setopt($ch, CURLOPT_POSTFIELDS, $input);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$output = curl_exec($ch);
print curl_getinfo($ch, CURLINFO_HTTP_CODE) . &quot;\n&quot;;
print $output . &quot;\n&quot;;
curl_close($ch);
?&gt;
</pre>
<p>Mint identifier:</p>
<pre class="literal-block">
&lt;?php
$input = '_target: <span class="hl2">url</span>
<span class="hl2">element1</span>: <span class="hl2">value1</span>
<span class="hl2">element2</span>: <span class="hl2">value2</span>';
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'https://ezid.cdlib.org/shoulder/<span class="hl2">shoulder</span>');
curl_setopt($ch, CURLOPT_USERPWD, '<span class="hl2">username</span>:<span class="hl2">password</span>');
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_HTTPHEADER,
  array('Content-Type: text/plain; charset=UTF-8',
        'Content-Length: ' . strlen($input)));
curl_setopt($ch, CURLOPT_POSTFIELDS, $input);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$output = curl_exec($ch);
print curl_getinfo($ch, CURLINFO_HTTP_CODE) . &quot;\n&quot;;
print $output . &quot;\n&quot;;
curl_close($ch);
?&gt;
</pre>
<p>Update identifier:</p>
<pre class="literal-block">
&lt;?php
$input = '_target: <span class="hl2">url</span>';
$ch = curl_init();
curl_setopt($ch, CURLOPT_URL, 'https://ezid.cdlib.org/id/<span class="hl2">identifier</span>');
curl_setopt($ch, CURLOPT_USERPWD, '<span class="hl2">username</span>:<span class="hl2">password</span>');
curl_setopt($ch, CURLOPT_POST, true);
curl_setopt($ch, CURLOPT_HTTPHEADER,
  array('Content-Type: text/plain; charset=UTF-8',
        'Content-Length: ' . strlen($input)));
curl_setopt($ch, CURLOPT_POSTFIELDS, $input);
curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
$output = curl_exec($ch);
print curl_getinfo($ch, CURLINFO_HTTP_CODE) . &quot;\n&quot;;
print $output . &quot;\n&quot;;
curl_close($ch);
?&gt;
</pre>
</div>
<div class="section" id="perl-examples">
<h1>Perl examples</h1>
<p>The following Perl examples use the <a class="reference external" href="http://search.cpan.org/dist/libwww-perl/">libwww-perl (LWP)</a>
<span class="ext-icon"></span> library.</p>
<p>To get identifier metadata, parse and decode it, and store it in a
hash, <span class="hl1">%metadata</span>:</p>
<pre class="literal-block">
use LWP::UserAgent;

$ua = LWP::UserAgent-&gt;new;
$r = $ua-&gt;get(&quot;https://ezid.cdlib.org/id/<span class="hl2">identifier</span>&quot;);
if ($r-&gt;is_success) {
  ($statusline, $m) = split(/\n/, $r-&gt;decoded_content, 2);
  %metadata = map { map { s/%([0-9A-F]{2})/pack(&quot;C&quot;, hex($1))/egi; $_ }
    split(/: /, $_, 2) } split(/\n/, $m);
} else {
  print $r-&gt;code, $r-&gt;decoded_content;
}
</pre>
<p>The following example creates an identifier, supplying initial
metadata values from a hash, <span class="hl1">%metadata</span>.  Note that LWP is
particular about how https URLs are expressed.  In an LWP request the
protocol should be included but not a port number
(&quot;https://ezid.cdlib.org/...&quot;), but conversely when supplying
credentials the https port number should be included but not a
protocol (&quot;ezid.cdlib.org:443&quot;).</p>
<pre class="literal-block">
use Encode;
use HTTP::Request::Common;
use LWP::UserAgent;
use URI::Escape;

sub escape {
  (my $s = $_[0]) =~ s/([%:\r\n])/uri_escape($1)/eg;
  return $s;
}

%metadata = ( &quot;_target&quot; =&gt; &quot;<span class="hl2">url</span>&quot;,
  &quot;<span class="hl2">element1</span>&quot; =&gt; &quot;<span class="hl2">value1</span>&quot;,
  &quot;<span class="hl2">element2</span>&quot; =&gt; &quot;<span class="hl2">value2</span>&quot; );
$ua = LWP::UserAgent-&gt;new;
$ua-&gt;credentials(&quot;ezid.cdlib.org:443&quot;, &quot;EZID&quot;, &quot;<span class="hl2">username</span>&quot;, &quot;<span class="hl2">password</span>&quot;);
$r = $ua-&gt;request(PUT &quot;https://ezid.cdlib.org/id/<span class="hl2">identifier</span>&quot;,
  &quot;Content-Type&quot; =&gt; &quot;text/plain; charset=UTF-8&quot;,
  Content =&gt; encode(&quot;UTF-8&quot;, join(&quot;\n&quot;,
    map { escape($_) . &quot;: &quot; . escape($metadata{$_}) } keys %metadata)));
print $r-&gt;code, $r-&gt;decoded_content unless $r-&gt;is_success;
</pre>
<p>To mint an identifier (in this case supplying no metadata initially),
obtaining a new identifier, <span class="hl1">$identifier</span>:</p>
<pre class="literal-block">
use HTTP::Request::Common;
use LWP::UserAgent;

$ua = LWP::UserAgent-&gt;new;
$ua-&gt;credentials(&quot;ezid.cdlib.org:443&quot;, &quot;EZID&quot;, &quot;<span class="hl2">username</span>&quot;, &quot;<span class="hl2">password</span>&quot;);
$r = $ua-&gt;request(POST &quot;https://ezid.cdlib.org/shoulder/<span class="hl2">shoulder</span>&quot;,
  &quot;Content-Type&quot; =&gt; &quot;text/plain; charset=UTF-8&quot;);
if ($r-&gt;is_success) {
  $identifier = $r-&gt;decoded_content =~ m/success: ([^ ]*)/ &amp;&amp; $1;
} else {
  print $r-&gt;code, $r-&gt;decoded_content;
}
</pre>
<p>To update an identifier using values from a hash, <span class="hl1">%metadata</span>:</p>
<pre class="literal-block">
use Encode;
use HTTP::Request::Common;
use LWP::UserAgent;
use URI::Escape;

sub escape {
  (my $s = $_[0]) =~ s/([%:\r\n])/uri_escape($1)/eg;
  return $s;
}

%metadata = ( &quot;_target&quot; =&gt; &quot;<span class="hl2">url</span>&quot; );
$ua = LWP::UserAgent-&gt;new;
$ua-&gt;credentials(&quot;ezid.cdlib.org:443&quot;, &quot;EZID&quot;, &quot;<span class="hl2">username</span>&quot;, &quot;<span class="hl2">password</span>&quot;);
$r = $ua-&gt;request(POST &quot;https://ezid.cdlib.org/id/<span class="hl2">identifier</span>&quot;,
  &quot;Content-Type&quot; =&gt; &quot;text/plain; charset=UTF-8&quot;,
  Content =&gt; encode(&quot;UTF-8&quot;, join(&quot;\n&quot;,
    map { escape($_) . &quot;: &quot; . escape($metadata{$_}) } keys %metadata)));
print $r-&gt;code, $r-&gt;decoded_content unless $r-&gt;is_success;
</pre>
</div>
<div class="section" id="java-example">
<h1>Java example</h1>
<p>A number of Java code snippets have been presented above.  In the
example below we combine them all into a runnable, end-to-end program
that mints a test identifier and then retrieves and prints the
identifier's metadata.</p>
<pre class="literal-block">
import java.io.*;
import java.net.*;
import java.util.*;

class harness {

    static String SERVER = &quot;https://ezid.cdlib.org&quot;;
    static String USERNAME = &quot;<span class="hl2">username</span>&quot;;
    static String PASSWORD = &quot;<span class="hl2">password</span>&quot;;

    static class MyAuthenticator extends Authenticator {
        protected PasswordAuthentication getPasswordAuthentication () {
            return new PasswordAuthentication(
                USERNAME, PASSWORD.toCharArray());
        }
    }

    static class Response {

        int responseCode;
        String status;
        String statusLineRemainder;
        HashMap&lt;String, String&gt; metadata;

        public String toString () {
            StringBuffer b = new StringBuffer();
            b.append(&quot;responseCode=&quot;);
            b.append(responseCode);
            b.append(&quot;\nstatus=&quot;);
            b.append(status);
            b.append(&quot;\nstatusLineRemainder=&quot;);
            b.append(statusLineRemainder);
            b.append(&quot;\nmetadata&quot;);
            if (metadata != null) {
                b.append(&quot; follows\n&quot;);
                Iterator&lt;Map.Entry&lt;String, String&gt;&gt; i =
                    metadata.entrySet().iterator();
                while (i.hasNext()) {
                    Map.Entry&lt;String, String&gt; e = i.next();
                    b.append(e.getKey() + &quot;: &quot; + e.getValue() + &quot;\n&quot;);
                }
            } else {
                b.append(&quot;=null\n&quot;);
            }
            return b.toString();
        }

    }

    static String encode (String s) {
        return s.replace(&quot;%&quot;, &quot;%25&quot;).replace(&quot;\n&quot;, &quot;%0A&quot;).
            replace(&quot;\r&quot;, &quot;%0D&quot;).replace(&quot;:&quot;, &quot;%3A&quot;);
    }

    static String toAnvl (HashMap&lt;String, String&gt; metadata) {
        Iterator&lt;Map.Entry&lt;String, String&gt;&gt; i =
            metadata.entrySet().iterator();
        StringBuffer b = new StringBuffer();
        while (i.hasNext()) {
            Map.Entry&lt;String, String&gt; e = i.next();
            b.append(encode(e.getKey()) + &quot;: &quot; +
                     encode(e.getValue()) + &quot;\n&quot;);
        }
        return b.toString();
    }

    static String decode (String s) {
        StringBuffer b = new StringBuffer();
        int i;
        while ((i = s.indexOf(&quot;%&quot;)) &gt;= 0) {
            b.append(s.substring(0, i));
            b.append((char)
                     Integer.parseInt(s.substring(i+1, i+3), 16));
            s = s.substring(i+3);
        }
        b.append(s);
        return b.toString();
    }

    static String[] parseAnvlLine (String line) {
        String[] kv = line.split(&quot;:&quot;, 2);
        kv[0] = decode(kv[0]).trim();
        kv[1] = decode(kv[1]).trim();
        return kv;
    }

    static Response issueRequest (
        String method, String path, HashMap&lt;String, String&gt; metadata)
        throws Exception {
        HttpURLConnection c = (HttpURLConnection)
            (new URL(SERVER + &quot;/&quot; + path)).openConnection();
        c.setRequestMethod(method);
        c.setRequestProperty(&quot;Accept&quot;, &quot;text/plain&quot;);
        if (metadata != null) {
            c.setDoOutput(true);
            c.setRequestProperty(&quot;Content-Type&quot;,
                                 &quot;text/plain; charset=UTF-8&quot;);
            OutputStreamWriter w =
                new OutputStreamWriter(c.getOutputStream(), &quot;UTF-8&quot;);
            w.write(toAnvl(metadata));
            w.flush();
        }
        Response r = new Response();
        r.responseCode = c.getResponseCode();
        InputStream is = r.responseCode &lt; 400? c.getInputStream() :
            c.getErrorStream();
        if (is != null) {
            BufferedReader br = new BufferedReader(
                new InputStreamReader(is, &quot;UTF-8&quot;));
            String[] kv = parseAnvlLine(br.readLine());
            r.status = kv[0];
            r.statusLineRemainder = kv[1];
            HashMap&lt;String, String&gt; d = new HashMap&lt;String, String&gt;();
            String l;
            while ((l = br.readLine()) != null) {
                kv = parseAnvlLine(l);
                d.put(kv[0], kv[1]);
            }
            if (d.size() &gt; 0) r.metadata = d;
        }
        return r;
    }

    public static void main (String[] args) throws Exception {

        Authenticator.setDefault(new MyAuthenticator());

        // Sample POST request.
        System.out.println(&quot;Issuing POST request...&quot;);
        HashMap&lt;String, String&gt; metadata =
            new HashMap&lt;String, String&gt;();
        metadata.put(&quot;erc.what&quot;, &quot;a test&quot;);
        Response r = issueRequest(
            &quot;POST&quot;, &quot;shoulder/ark:/99999/fk4&quot;, metadata);
        System.out.print(r);

        // Sample GET request.
        System.out.println(&quot;\nIssuing GET request...&quot;);
        String id = r.statusLineRemainder;
        r = issueRequest(&quot;GET&quot;, &quot;id/&quot; + URLEncoder.encode(id, &quot;UTF-8&quot;),
                         null);
        System.out.print(r);

    }

}
</pre>
</div>
<div class="section" id="curl-examples">
<h1>curl examples</h1>
<p>The EZID API can be exercised using the <a class="reference external" href="http://curl.haxx.se/">curl</a> <span class="ext-icon"></span> command
line tool.  The following examples assume metadata is UTF-8 encoded
throughout.</p>
<p>To get identifier metadata, obtaining text formatted as described in
<a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a> above:</p>
<pre class="literal-block">
curl https://ezid.cdlib.org/id/<span class="hl2">identifier</span>
</pre>
<p>To mint an identifier:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X POST https://ezid.cdlib.org/shoulder/<span class="hl2">shoulder</span>
</pre>
<p>A single metadata element can be specified on the command line.  For
example, to mint an identifier and specify a target URL at the same
time:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X POST -H 'Content-Type: text/plain'
  --data-binary '_target: <span class="hl2">url</span>' https://ezid.cdlib.org/shoulder/<span class="hl2">shoulder</span>
</pre>
<p>To specify more than one metadata element, the metadata must be placed
in a file that is formatted as described in <a class="reference internal" href="#request-response-bodies">Request &amp; response
bodies</a>.  For example, to mint an identifier and upload metadata
contained in a file <span class="hl1">metadata.txt</span>:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X POST -H 'Content-Type: text/plain'
  --data-binary &#64;<span class="hl2">metadata.txt</span> https://ezid.cdlib.org/shoulder/<span class="hl2">shoulder</span>
</pre>
<p>Creating an identifier is similar to minting one, except that the HTTP
method (-X option) is changed from POST to PUT and an identifier is
specified instead of a shoulder.  Here are the three examples above,
but now creating an identifier:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X PUT https://ezid.cdlib.org/id/<span class="hl2">identifier</span>

curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X PUT -H 'Content-Type: text/plain'
  --data-binary '_target: <span class="hl2">url</span>' https://ezid.cdlib.org/id/<span class="hl2">identifier</span>

curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X PUT -H 'Content-Type: text/plain'
  --data-binary &#64;<span class="hl2">metadata.txt</span> https://ezid.cdlib.org/id/<span class="hl2">identifier</span>
</pre>
<p>To update identifier metadata:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X POST -H 'Content-Type: text/plain'
  --data-binary '_target: <span class="hl2">url</span>' https://ezid.cdlib.org/id/<span class="hl2">identifier</span>

curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -X POST -H 'Content-Type: text/plain'
  --data-binary &#64;<span class="hl2">metadata.txt</span> https://ezid.cdlib.org/id/<span class="hl2">identifier</span>
</pre>
</div>
<div class="section" id="batch-processing">
<h1>Batch processing</h1>
<p>The API does not directly support batch processing, but EZID does
provide two client tools, linked from this documentation, that can
simplify the work of scripting a batch job.  First and most generally,
the <a class="reference internal" href="#python-command-line-tool">Python command line tool</a> can exercise all API functions and is
straightforward to script.  For example, to mint and print 100 test
ARK identifiers:</p>
<pre class="literal-block">
#! /bin/bash
for i in {1..100}; do
  ezid.py <span class="hl2">username</span>:<span class="hl2">password</span> mint ark:/99999/fk4 | awk '{ print $2 }'
done
</pre>
<p>Second, the <a class="reference external" href="https://github.com/CDLUC3/ezid-client-tools/blob/master/batch-register.py">batch-register.py</a> <span class="ext-icon"></span> script automates several
common types of batch processing.  It reads an input CSV file
containing identifier metadata, one row per identifier; transforms the
metadata into EZID metadata as directed by a configuration file of
mappings; creates or mints identifiers, or updates existing
identifiers, using that metadata; and outputs a CSV file containing
the created, minted, or updated identifiers and other information.
Detailed usage information is contained in the script itself, but to
give a taste of what it can do, given an input CSV file with columns,</p>
<pre class="literal-block">
title,author,orcid,publisher_name,publisher_place,url
</pre>
<p>a possible complete mapping file to mint DOI identifiers is shown
below.  The mappings reference both EZID metadata elements and, using
XPath expressions, <a class="reference external" href="http://schema.datacite.org/">DataCite Metadata Scheme</a> <span class="ext-icon"></span> elements
and attributes.</p>
<pre class="literal-block">
_profile = datacite
/resource/titles/title = $1
/resource/creators/creator/creatorName = $2
/resource/creators/creator/nameIdentifier = $3
/resource/creators/creator/nameIdentifier&#64;nameIdentifierScheme = ORCID
/resource/publisher = $4 ($5)
/resource/publicationYear = 2018
/resource/resourceType&#64;resourceTypeGeneral = Dataset
_target = $6
</pre>
<p>For another example, to update the statuses of a batch of existing
identifiers to public, given an input file listing the identifiers
(i.e., a CSV file with just one column), a mapping file would be:</p>
<pre class="literal-block">
_id = $1
_status = public
</pre>
</div>
<div class="section" id="batch-download">
<h1>Batch download</h1>
<p>The metadata for all identifiers matching a set of constraints can be
downloaded in one batch operation.  Authentication is required, and
the scope of the identifiers that can be downloaded in this way is
implicitly restricted to those that are directly owned by or otherwise
updatable by the requestor.</p>
<p>Batch download and harvesting (see <a class="reference internal" href="#oai-pmh-harvesting">OAI-PMH harvesting</a> below) are
similar but different operations.  With batch download, the
identifiers returned are restricted to those updatable by the
requestor as noted above, but within that scope it is possible to
download <em>all</em> identifiers, including reserved, unavailable, and test
identifiers.  By contrast, with harvesting, no authentication is
required and the identifiers returned are not restricted by ownership,
but only those identifiers that are public and exported and that
satisfy several other quality criteria are returned.</p>
<p><strong>Subsections</strong></p>
<ul class="simple">
<li><a class="reference internal" href="#overview">Overview</a></li>
<li><a class="reference internal" href="#download-formats">Download formats</a></li>
<li><a class="reference internal" href="#parameters">Parameters</a></li>
<li><a class="reference internal" href="#using-curl-to-request-a-download">Using curl to request a download</a></li>
</ul>
<p id="overview"><strong>Overview</strong></p>
<p>The batch download process is asynchronous.  A download is requested
by issuing a POST request to</p>
<blockquote>
<a class="reference external" href="https://ezid.cdlib.org/download_request">https://ezid.cdlib.org/download_request</a></blockquote>
<p>The content type of the request body must be
&quot;application/x-www-form-urlencoded&quot; and the body must include one POST
parameter, &quot;format&quot;, specifying the download format, and may include
additional parameters (see <a class="reference internal" href="#parameters">Parameters</a> below) specifying search
criteria and download format and notification options.  The return is
a status line indicating either error (see <a class="reference internal" href="#error-reporting">Error reporting</a> above)
or success.  If successful, the status line includes a URL from which
the download can be retrieved.  Here's a sample interaction:</p>
<pre class="literal-block">
⇒ POST /download_request HTTP/1.1
⇒ Host: ezid.cdlib.org
⇒ Content-Type: application/x-www-form-urlencoded
⇒ Content-Length: 19
⇒
⇒ format=xml&amp;type=ark

⇐ HTTP/1.1 200 OK
⇐ Content-Type: text/plain; charset=UTF-8
⇐ Content-Length: 57
⇐
⇐ success: https://ezid.cdlib.org/download/da543b91a0.xml.gz
</pre>
<p>The download will not be available immediately, but clients can poll
the returned URL; the server returns HTTP status code 404 (Not Found)
if the download is not yet ready.  As part of the request, clients can
also specify an email address to which a notification will be sent
when the download becomes available.  Downloads are retained for one
week.</p>
<p id="download-formats"><strong>Download formats</strong></p>
<p>Identifier metadata is returned in one of three formats; which format
is determined by the &quot;format&quot; parameter.  In all cases, the text
encoding is UTF-8 and the metadata is compressed with either <a class="reference external" href="http://www.gzip.org/">gzip</a>
<span class="ext-icon"></span> or <a class="reference external" href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">ZIP</a> <span class="ext-icon"></span> as determined by the
&quot;compression&quot; parameter.</p>
<ol class="arabic">
<li><p class="first"><strong>Format &quot;anvl&quot;</strong>.  This format is effectively the concatenation of
performing a get metadata operation (see <a class="reference internal" href="#operation-get-identifier-metadata">Operation: get identifier
metadata</a> above) on each selected identifier.  Metadata is
returned in ANVL format and employs percent-encoding as described
in <a class="reference internal" href="#request-response-bodies">Request &amp; response bodies</a>.  The metadata for an identifier is
preceded by a header line that contains two colons (&quot;:&quot;, U+003A)
followed by the identifier.  Blocks of metadata are separated by
blank lines.  For example:</p>
<pre class="literal-block">
:: ark:/99999/fk4gt78tq
_created: 1300812337
_export: yes
_owner: apitest
_ownergroup: apitest
_profile: erc
_status: public
_target: http://www.gutenberg.org/ebooks/7178
_updated: 1300913550
erc.what: Remembrance of Things Past
erc.when: 1922
erc.who: Proust, Marcel

:: doi:10.5072/FK2S75905Q
_created: 1421276359
_datacenter: CDL.CDL
_export: yes
_owner: apitest
_ownergroup: apitest
_profile: datacite
_status: public
_target: http://www.gutenberg.org/ebooks/26014
_updated: 1421276359
datacite: &lt;?xml version=&quot;1.0&quot;?&gt;%0A&lt;resource xmlns=&quot;http://...
</pre>
</li>
<li><p class="first"><strong>Format &quot;csv&quot;</strong>.  Metadata is returned as an Excel-compatible
<a class="reference external" href="http://en.wikipedia.org/wiki/Comma-separated_values">Comma-separated values (CSV)</a> <span class="ext-icon"></span> table, one row per
selected identifier.  A header row lists column names.  The columns
to return must be specified using one or more &quot;column&quot; parameters;
the order of columns in the table matches the parameter order.  The
columns that can be returned include all internal EZID metadata
elements (refer to <a class="reference internal" href="#internal-metadata">Internal metadata</a>) and all citation metadata
elements (refer to <a class="reference internal" href="#metadata-profiles">Metadata profiles</a>).  Additionally, the
following columns may be requested:</p>
<ul>
<li><p class="first">_id</p>
<p>The identifier.</p>
</li>
<li><p class="first">_mappedCreator, _mappedTitle, _mappedPublisher, _mappedDate,
_mappedType</p>
<p>Creator, title, publisher, date, and type citation metadata as
mapped from the identifier's preferred metadata profile.</p>
</li>
</ul>
<p>Continuing with the previous example, if the parameters are</p>
<pre class="literal-block">
format=csv&amp;column=_id&amp;column=_owner&amp;column=erc.when&amp;column=_mappedCreator
</pre>
<p>then the following table will be returned:</p>
<pre class="literal-block">
_id,_owner,erc.when,_mappedCreator
ark:/99999/fk4gt78tq,apitest,1922,&quot;Proust, Marcel&quot;
doi:10.5072/FK2S75905Q,apitest,,Montagu Browne
</pre>
<p>Note that for the CSV format only, line terminators in metadata
values (both newlines (&quot;\n&quot;, U+000A) and carriage returns (&quot;\r&quot;,
U+000D)) are converted to spaces.</p>
</li>
<li><p class="first"><strong>Format &quot;xml&quot;</strong>.  Metadata is returned as a single XML document.
The root element, &lt;records&gt;, contains a &lt;record&gt; element for each
selected identifier, and within each &lt;record&gt; element are &lt;element&gt;
elements for each of the identifier's metadata elements.  Thus the
returned document will have the structure:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records&gt;
  &lt;record identifier=&quot;<span class="hl2">identifier</span>&quot;&gt;
    &lt;element name=&quot;<span class="hl2">name</span>&quot;&gt;<span class="hl2">value</span> &lt;/element&gt;
    ...
  &lt;/record&gt;
  ...
&lt;/records&gt;
</pre>
<p>As a special case, XML metadata bound to a &quot;datacite&quot; or &quot;crossref&quot;
element is directly embedded in the containing &lt;element&gt; element,
i.e., the metadata will appear as an XML subelement and not as a
string value.</p>
<p>Continuing with the previous example, the return in XML format
would be:</p>
<pre class="literal-block">
&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;records&gt;
  &lt;record identifier=&quot;ark:/99999/fk4gt78tq&quot;&gt;
    &lt;element name=&quot;_created&quot;&gt;1300812337&lt;/element&gt;
    &lt;element name=&quot;_export&quot;&gt;yes&lt;/element&gt;
    &lt;element name=&quot;_owner&quot;&gt;apitest&lt;/element&gt;
    &lt;element name=&quot;_ownergroup&quot;&gt;apitest&lt;/element&gt;
    &lt;element name=&quot;_profile&quot;&gt;erc&lt;/element&gt;
    &lt;element name=&quot;_status&quot;&gt;public&lt;/element&gt;
    &lt;element name=&quot;_target&quot;&gt;http://www.gutenberg.org/ebooks/7178&lt;/element&gt;
    &lt;element name=&quot;_updated&quot;&gt;1300913550&lt;/element&gt;
    &lt;element name=&quot;erc.what&quot;&gt;Remembrance of Things Past&lt;/element&gt;
    &lt;element name=&quot;erc.when&quot;&gt;1922&lt;/element&gt;
    &lt;element name=&quot;erc.who&quot;&gt;Proust, Marcel&lt;/element&gt;
  &lt;/record&gt;
  &lt;record identifier=&quot;doi:10.5072/FK2S75905Q&quot;&gt;
    &lt;element name=&quot;_created&quot;&gt;1421276359&lt;/element&gt;
    &lt;element name=&quot;_datacenter&quot;&gt;CDL.CDL&lt;/element&gt;
    &lt;element name=&quot;_export&quot;&gt;yes&lt;/element&gt;
    &lt;element name=&quot;_owner&quot;&gt;apitest&lt;/element&gt;
    &lt;element name=&quot;_ownergroup&quot;&gt;apitest&lt;/element&gt;
    &lt;element name=&quot;_profile&quot;&gt;datacite&lt;/element&gt;
    &lt;element name=&quot;_status&quot;&gt;public&lt;/element&gt;
    &lt;element name=&quot;_target&quot;&gt;http://www.gutenberg.org/ebooks/26014&lt;/element&gt;
    &lt;element name=&quot;_updated&quot;&gt;1421276359&lt;/element&gt;
    &lt;element name=&quot;datacite&quot;&gt;
      &lt;resource xmlns=&quot;http://datacite.org/schema/kernel-4&quot;&gt;
        &lt;identifier identifierType=&quot;DOI&quot;&gt;10.5072/FK2S75905Q&lt;/identifier&gt;
        &lt;creators&gt;
          &lt;creator&gt;
            &lt;creatorName&gt;Montagu Browne&lt;/creatorName&gt;
          &lt;/creator&gt;
        &lt;/creators&gt;
        &lt;titles&gt;
          &lt;title&gt;Practical Taxidermy&lt;/title&gt;
        &lt;/titles&gt;
        &lt;publisher&gt;Charles Scribner's Sons&lt;/publisher&gt;
        &lt;publicationYear&gt;1884&lt;/publicationYear&gt;
        &lt;resourceType resourceTypeGeneral=&quot;Text&quot;/&gt;
      &lt;/resource&gt;
    &lt;/element&gt;
  &lt;/record&gt;
&lt;/records&gt;
</pre>
</li>
</ol>
<p id="parameters"><strong>Parameters</strong></p>
<p>Unless otherwise noted, parameters are optional and <em>not</em> repeatable.</p>
<ul>
<li><p class="first">format={anvl|csv|xml} <em>(required)</em></p>
<p>The download format, as described above.</p>
</li>
<li><p class="first">compression={gzip|zip}</p>
<p>The compression to use, <a class="reference external" href="http://www.gzip.org/">gzip</a> <span class="ext-icon"></span> or <a class="reference external" href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT">ZIP</a> <span class="ext-icon"></span>.
gzip is the default.</p>
</li>
<li><p class="first">column=<span class="hl1">c</span> <em>(repeatable)</em></p>
<p>Return column <span class="hl1">c</span>.  Applies to the &quot;csv&quot; format only, in which
case at least one column is required.</p>
</li>
<li><p class="first">notify=<span class="hl1">address</span> <em>(repeatable)</em></p>
<p>Send an email message to <span class="hl1">address</span> when the download becomes
available.</p>
</li>
<li><p class="first">convertTimestamps={yes|no}</p>
<p>If yes, convert Unix timestamp values bound to the &quot;_created&quot; and
&quot;_updated&quot; internal metadata elements to ISO 8601
YYYY-MM-DDTHH:MM:SSZ format.</p>
</li>
</ul>
<p>The remaining parameters are search constraints.  Search constraints
are logically ANDed together, but search constraint parameters that
are repeated have the effect of creating a logical OR of the selected
values.  For example, parameter &quot;status&quot; can take on three possible
values, &quot;reserved&quot;, &quot;public&quot;, or &quot;unavailable&quot;.  If no &quot;status&quot;
parameter is specified, there is no constraint on identifier status;
if &quot;status=reserved&quot; is specified, then only reserved identifiers are
returned; and if &quot;status=reserved&amp;status=public&quot; is specified, then
reserved and public identifiers are returned (but not unavailable
identifiers).</p>
<ul>
<li><p class="first">createdAfter=<span class="hl1">t</span></p>
<p>Return identifiers created on or after time <span class="hl1">t</span>.  The time may
be given as a Unix timestamp or in ISO 8601 YYYY-MM-DDTHH:MM:SSZ
format.  Note that lower time bounds are inclusive.</p>
</li>
<li><p class="first">createdBefore=<span class="hl1">t</span></p>
<p>Return identifiers created before time <span class="hl1">t</span>.  The time may be
given as a Unix timestamp or in ISO 8601 YYYY-MM-DDTHH:MM:SSZ
format.  Note that upper time bounds are exclusive.</p>
</li>
<li><p class="first">crossref={yes|no}</p>
<p>Return identifiers that either are or are not registered with
Crossref.</p>
</li>
<li><p class="first">datacite={yes|no}</p>
<p>Return identifiers that either are or are not registered with
DataCite.</p>
</li>
<li><p class="first">exported={yes|no}</p>
<p>Return identifiers that either are or are not exported.</p>
</li>
<li><p class="first">owner=<span class="hl1">u</span> (<em>repeatable</em>)</p>
<p>Return identifiers owned by user <span class="hl1">u</span>, where <span class="hl1">u</span> is an EZID
username, e.g., &quot;apitest&quot;.  All &quot;owner&quot; and &quot;ownergroup&quot; parameters
are ORed together; if none are specified, the identifiers directly
owned by the requestor are returned.</p>
</li>
<li><p class="first">ownergroup=<span class="hl1">g</span> <em>(repeatable)</em></p>
<p>Return identifiers owned by group <span class="hl1">g</span>, where <span class="hl1">g</span> is an
EZID group name, e.g., &quot;cdl&quot;.  All &quot;owner&quot; and &quot;ownergroup&quot;
parameters are ORed together; if none are specified, the identifiers
directly owned by the requestor are returned.</p>
</li>
<li><p class="first">permanence={test|real}</p>
<p>Return only test identifiers or only real identifiers.</p>
</li>
<li><p class="first">profile=<span class="hl1">p</span> <em>(repeatable)</em></p>
<p>Return identifiers whose preferred metadata profile is <span class="hl1">p</span>.</p>
</li>
<li><p class="first">status={reserved|public|unavailable} <em>(repeatable)</em></p>
<p>Return identifiers having the specified status.</p>
</li>
<li><p class="first">type={ark|doi|uuid} <em>(repeatable)</em></p>
<p>Return identifiers of the specified type.</p>
</li>
<li><p class="first">updatedAfter=<span class="hl1">t</span>, updatedBefore=<span class="hl1">t</span></p>
<p>Constraints against update time; see the comparable &quot;createdAfter&quot;
and &quot;createdBefore&quot; parameters above.</p>
</li>
</ul>
<p id="using-curl-to-request-a-download"><strong>Using curl to request a download</strong></p>
<p>A batch download can easily be requested using the
<a class="reference external" href="http://curl.haxx.se/">curl</a> <span class="ext-icon"></span> command line tool.  Use curl's &quot;-d&quot; option to
specify parameters, and use the &quot;-u&quot; option to supply credentials.
For example:</p>
<pre class="literal-block">
curl -u <span class="hl2">username</span>:<span class="hl2">password</span> -d format=anvl -d type=ark -d type=doi
  -d permanence=real https://ezid.cdlib.org/download_request
</pre>
<p>For even more convenience, a simple Bash script, <a class="reference external" href="https://github.com/CDLUC3/ezid-client-tools/blob/master/batch-download.sh">batch-download.sh</a>
<span class="ext-icon"></span>, turns a batch download into a one-step operation.  The
script issues a download request using curl, waits for the request to
be processed, and when ready downloads to a file in the current
directory.  Its usage equivalent to the above example would be:</p>
<pre class="literal-block">
% batch-download.sh <span class="hl2">username</span> <span class="hl2">password</span> format=anvl type=ark type=doi permanence=real
submitting download request...
waiting......
9c02f494ab.txt.gz
</pre>
</div>
<div class="section" id="oai-pmh-harvesting">
<h1>OAI-PMH harvesting</h1>
<p>EZID supports harvesting of identifiers and citation metadata via <a class="reference external" href="http://www.openarchives.org/OAI/openarchivesprotocol.html">The
Open Archives Initiative Protocol for Metadata Harvesting (OAI-PMH)</a>
<span class="ext-icon"></span>, version 2.0.  The base URL for OAI-PMH access is</p>
<blockquote>
<a class="reference external" href="https://ezid.cdlib.org/oai">https://ezid.cdlib.org/oai</a></blockquote>
<p>Only public, exported, non-test identifiers that have non-default
target URLs and at least creator, title, and date citation metadata
(in <a class="reference internal" href="#profile-erc">ERC</a> terms, who/what/when metadata) are made available through
OAI-PMH.</p>
<p>Harvesting and batch download are similar but different operations;
see <a class="reference internal" href="#batch-download">Batch download</a> for the differences.</p>
<p>In returning an identifier's metadata, EZID maps citation metadata
from the identifier's preferred metadata profile (see <a class="reference internal" href="#metadata-profiles">Metadata
profiles</a> above) to one of two delivery formats: <a class="reference external" href="http://dublincore.org/documents/dces/">Dublin Core</a>
<span class="ext-icon"></span> (as required by the protocol) or <a class="reference external" href="http://schema.datacite.org/">DataCite</a>
<span class="ext-icon"></span>.  In the latter case, older DataCite XML metadata
records stored in EZID are converted to version 4 of the DataCite
schema for uniformity.  Note that, in an extension to the DataCite
schema, the identifier type for non-DOI identifiers is set to &quot;ARK&quot; or
&quot;UUID&quot; as appropriate.</p>
</div>
</div>
{% endblock %}
