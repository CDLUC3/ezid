/*
 * CopyrightÂ©2021, Regents of the University of California
 * http://creativecommons.org/licenses/BSD
 */

/* Include file to attach javascript actions to simple creation form */

$(document).ready(function() {
  /* Determine value of 'current_profile' based on shoulder that is selected  */
  var orig_val = $('input[name=shoulder]:checked', '#create_form').val();

  $("input[name=shoulder]").change(function(e) {
    var new_scheme = e.target.value.split(':')[0];
    const target_id = e.target.id;
    if(orig_val.split(':')[0] != new_scheme){
    // changing scheme
      if(new_scheme == 'doi'){
        $('#current_profile').attr('value', 'datacite');
      }else{
        $('#current_profile').attr('value', 'erc');
      }
      do_get(target_id);  // submit form with new profile, and the target id is the element the user was on for returning
    }
    orig_val = e.target.value;
  });

  /* Redirect to Advanced ID create: Handle tab clicking for keyboard users */
  function actTab2() {
    document.getElementById('tab-2').checked = false;
    document.getElementById('tab-1').checked = true;
    action = location.pathname.split("/")[1];  // Handle create or demo pages
<<<<<<< HEAD
    window.location.href = "/" + action + "/advanced#tab-2";
=======
    window.location.href = "/" + action + "/advanced#tab-2-label";
>>>>>>> 919-bug-unexpected-change-of-context-in-profile-dropdown
  }
  // Act on keyboard enter or spacebar
  $("#tab-2-label").keyup(function(e){
    var code = e.which;
    if(code==13)e.preventDefault();
    if(code==32||code==13||code==188||code==186){
      actTab2();
    }
  });

  $('#tab-2:not(:checked)').on('change', function() {
    actTab2();
  });

  // ***** Submit form when profile or shoulder changes ******* //
  // If triggered by profile, then, after submission, scroll page down to specified anchor
  function do_get(includeAnchor){
      var frm = $('#create_form');
      frm.attr('action', location.pathname + '?publish=' +
        $("[name='publish']").val() + '&remainder=' + $("#remainder").val());
      if (includeAnchor) {
        var input = $("<input>", { type: "hidden", name: "anchor", value: includeAnchor});
        frm.append($(input));
      }
      frm.unbind('submit');
      frm.attr('method', 'get');
      frm.submit();
  }

});
